<!DOCTYPE html><html lang="en-us" class="__variable_dd5b2f scroll-smooth"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/36966cca54120369-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" as="image" href="https://substackcdn.com/image/fetch/$s_!kIqJ!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe9c04393-d2fb-47f0-93d7-d2724edbda56_705x502.png"/><link rel="preload" as="image" href="https://substackcdn.com/image/fetch/$s_!txJ0!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2f0cbd7f-e98d-4fce-ae43-4945e46bf095_1582x502.png"/><link rel="preload" as="image" href="https://substackcdn.com/image/fetch/$s_!KWBT!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe4416acc-dcc2-4af7-80f6-a56aa8c8a9c6_1240x454.png"/><link rel="stylesheet" href="/_next/static/css/c890694439b2475b.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/1ea5cf861ee12a80.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/a9b9096fa657c0d0.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-8506c16620cf39fb.js"/><script src="/_next/static/chunks/fd9d1056-30760135124e6678.js" async=""></script><script src="/_next/static/chunks/23-44b8024386371b46.js" async=""></script><script src="/_next/static/chunks/main-app-06a10a1bb45617e8.js" async=""></script><script src="/_next/static/chunks/ebde5ed1-51545511fe0d5050.js" async=""></script><script src="/_next/static/chunks/231-34a6a67d2da26855.js" async=""></script><script src="/_next/static/chunks/827-69594f61c16b8a9c.js" async=""></script><script src="/_next/static/chunks/850-ecf153581cc02044.js" async=""></script><script src="/_next/static/chunks/app/layout-54bebb918ae7f176.js" async=""></script><script src="/_next/static/chunks/app/blog/%5B...slug%5D/page-bd056182432da53b.js" async=""></script><script src="https://us.umami.is/script.js" async=""></script><title>B树（B-Tree）详解 - 为什么每个数据库都在使用它</title><meta name="description" content="B树是一种自平衡树数据结构，专为磁盘存储优化。与二叉搜索树不同，B树的每个节点可以有成百上千个子节点，这大大减少了树的深度，使得在磁盘上的查找效率显著提高。本文深入解析B树的设计原理、实现细节，以及为什么50多年来它一直是数据库索引的首选数据结构。"/><meta name="robots" content="index, follow"/><meta name="googlebot" content="index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1"/><link rel="canonical" href="https://blog.mainjay.cloudns.ch/blog/algorithm/B-Tree"/><link rel="alternate" type="application/rss+xml" href="https://blog.mainjay.cloudns.ch/feed.xml"/><meta property="og:title" content="B树（B-Tree）详解 - 为什么每个数据库都在使用它"/><meta property="og:description" content="B树是一种自平衡树数据结构，专为磁盘存储优化。与二叉搜索树不同，B树的每个节点可以有成百上千个子节点，这大大减少了树的深度，使得在磁盘上的查找效率显著提高。本文深入解析B树的设计原理、实现细节，以及为什么50多年来它一直是数据库索引的首选数据结构。"/><meta property="og:url" content="https://blog.mainjay.cloudns.ch/blog/algorithm/B-Tree"/><meta property="og:site_name" content="MainJayLai Blog"/><meta property="og:locale" content="en_US"/><meta property="og:image" content="https://blog.mainjay.cloudns.ch/static/images/b-tree-structure.png"/><meta property="og:type" content="article"/><meta property="article:published_time" content="2025-11-28T00:00:00.000Z"/><meta property="article:modified_time" content="2025-11-28T00:00:00.000Z"/><meta property="article:author" content="mainJayLai"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="B树（B-Tree）详解 - 为什么每个数据库都在使用它"/><meta name="twitter:description" content="B树是一种自平衡树数据结构，专为磁盘存储优化。与二叉搜索树不同，B树的每个节点可以有成百上千个子节点，这大大减少了树的深度，使得在磁盘上的查找效率显著提高。本文深入解析B树的设计原理、实现细节，以及为什么50多年来它一直是数据库索引的首选数据结构。"/><meta name="twitter:image" content="https://blog.mainjay.cloudns.ch/static/images/b-tree-structure.png"/><meta name="next-size-adjust"/><link rel="icon" type="image/png" href="https://mainjaylai.github.io/favicon.png"/><link rel="manifest" href="/static/favicons/manifest.json"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"/><meta name="referrer" content="no-referrer"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@200..900&amp;display=swap" rel="stylesheet"/><link href="https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&amp;family=ZCOOL+QingKe+HuangYou&amp;family=ZCOOL+XiaoWei&amp;display=swap" rel="stylesheet"/><script src="https://cdn.jsdelivr.net/gh/ashishagarwal2023/freegptjs@1.0.2/src/freegpt.min.js"></script><script src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js" noModule=""></script></head><body class="bg-white pl-[calc(100vw-100%)] text-black antialiased dark:bg-gray-950 dark:text-white"><script>!function(){try{var d=document.documentElement,c=d.classList;c.remove('light','dark');var e=localStorage.getItem('theme');if('system'===e||(!e&&false)){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';c.add('dark')}else{d.style.colorScheme = 'light';c.add('light')}}else if(e){c.add(e|| '')}else{c.add('light')}if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'light'}catch(e){}}()</script><section class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex h-screen flex-col justify-between font-sans"><header class="flex items-center justify-between py-5"><div><a aria-label="Blog" href="/"><div class="flex items-center justify-between"><div class="mr-3"><img alt="logo" loading="lazy" width="44" height="44" decoding="async" data-nimg="1" style="color:transparent" src="https://mainjaylai.github.io/favicon.png"/></div><div class="hidden h-[44px] text-center text-3xl font-semibold leading-10 sm:block">Blog</div></div></a></div><div class="flex items-center space-x-4 leading-5 sm:space-x-6"><a class="navbar-item hidden font-medium text-gray-900 dark:text-gray-100 sm:block" href="/blog">Blog</a><a class="navbar-item hidden font-medium text-gray-900 dark:text-gray-100 sm:block" href="/tags">Tags</a><a target="_blank" rel="noopener noreferrer" href="https://mainjaylai.github.io" class="navbar-item hidden font-medium text-gray-900 dark:text-gray-100 sm:block">About</a><button aria-label="Search"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-6 w-6 text-gray-900 dark:text-gray-100"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"></path></svg></button><div class="mr-8"><div class="relative inline-block text-left" data-headlessui-state=""><div><button id="headlessui-menu-button-:R5pkqja:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="h-6 w-6 text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clip-rule="evenodd"></path></svg></button></div></div></div><button aria-label="AI Chat" class="flex items-center justify-center rounded-full p-1.5 text-gray-800 transition-all hover:bg-gray-100 dark:text-gray-200 dark:hover:bg-gray-800"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path><path d="M8 9h8"></path><path d="M8 13h6"></path></svg></button><div class="mr-5"><div class="relative inline-block text-left" data-headlessui-state=""><div><button class="flex items-center" id="headlessui-menu-button-:R6pkqja:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><div class="mr-2">简体中文</div><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1616" width="15" height="15"><path d="M670.72 325.696L511.552 152l87.68-87.872 360.96 389.504L832 453.76v0.64H64V325.76h606.72z m-318.4 382.08l157.248 172.8-94.976 79.552L63.872 579.84l147.712-0.704v-0.128H960v128.768H352.32z" fill="#262626" p-id="1617"></path></svg></button></div></div></div><button aria-label="Toggle Menu" class="sm:hidden"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="h-8 w-8 text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="opacity-98 fixed left-0 top-0 z-10 h-full w-full transform bg-white duration-300 ease-in-out dark:bg-gray-950 dark:opacity-[0.98] translate-x-full"><div class="flex justify-end"><button class="mr-8 mt-8 h-8 w-8" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 opacity-80 dark:text-gray-100" href="/">Home</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 opacity-80 dark:text-gray-100" href="/blog">Blog</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 opacity-80 dark:text-gray-100" href="/tags">Tags</a></div><div class="px-12 py-4"><a target="_blank" rel="noopener noreferrer" href="https://mainjaylai.github.io" class="text-2xl font-bold tracking-widest text-gray-900 opacity-80 dark:text-gray-100">About</a></div></nav></div></div></header><main class="mb-auto"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"B树（B-Tree）详解 - 为什么每个数据库都在使用它","datePublished":"2025-11-28T00:00:00.000Z","dateModified":"2025-11-28T00:00:00.000Z","description":"B树是一种自平衡树数据结构，专为磁盘存储优化。与二叉搜索树不同，B树的每个节点可以有成百上千个子节点，这大大减少了树的深度，使得在磁盘上的查找效率显著提高。本文深入解析B树的设计原理、实现细节，以及为什么50多年来它一直是数据库索引的首选数据结构。","image":"/static/images/b-tree-structure.png","url":"https://blog.mainjay.cloudns.ch/blog/algorithm/B-Tree","author":[{"@type":"Person","name":"mainJayLai"}]}</script><section class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed bottom-8 right-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div><header><div class="space-y-1 border-b border-gray-200 pb-10 text-center dark:border-gray-700"><div class="beautiful-chinese-title"><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">B树（B-Tree）详解 - 为什么每个数据库都在使用它</h1></div><dl><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2025-11-28T00:00:00.000Z">November 28, 2025</time></dd></div></dl></div></header><div class="grid-rows-[auto_1fr] divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:divide-y-0"><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="beautiful-chinese-content prose max-w-none pb-8 pt-10 dark:prose-invert"><h2 class="content-header" id="为什么需要b树"><a href="#为什么需要b树" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>为什么需要B树？</h2><h3 class="content-header" id="问题的起源"><a href="#问题的起源" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>问题的起源</h3><p>storage/innobase/btr/btr0cur.cc</p><blockquote><p>btr_page_split_and_insert() in btr_cur_pessimistic_insert() invokes...</p></blockquote><p>悲观插入，这是当节点太满时的代码路径，当乐观插入失败时，当你必须分裂时。</p><p>我跟着函数找到<code class="custom-code">btr0btr.cc</code>。数百行C代码、分裂条件、溢出保护、还有一个我没有的边界检查。</p><p>我滚动查看我的Python代码：</p><div class="relative"><pre><code class="code-highlight language-python"><span class="code-line"><span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>keys<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> self<span class="token punctuation">.</span>order<span class="token punctuation">:</span>  <span class="token comment"># 没有-1</span>
</span><span class="code-line">    self<span class="token punctuation">.</span>_split_child<span class="token punctuation">(</span>parent<span class="token punctuation">,</span> index<span class="token punctuation">)</span>
</span></code></pre></div><p>书里已经警告过这一点。第263页：&quot;如果一个节点最多能容纳N个键值对，再插入一个就超过了它的最大容量N。&quot;</p><p>超过，不是等于，是超过！</p><h2 class="content-header" id="b树的设计思想"><a href="#b树的设计思想" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>B树的设计思想</h2><h3 class="content-header" id="核心思想"><a href="#核心思想" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>核心思想</h3><p>B树是一种自平衡树，专为磁盘访问优化。与二叉搜索树（每个节点只有2个子节点）不同，B树的每个节点有<strong>成百上千</strong>个子节点。</p><p><strong>关键思想</strong>：每个B树节点都装入一个磁盘块（4KB到16KB）。既然我们必须读取整个块，那就尽可能多地打包键值对。</p><h3 class="content-header" id="为什么这样设计是高效的"><a href="#为什么这样设计是高效的" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>为什么这样设计是高效的？</h3><ol><li><p><strong>二进制特性</strong>：</p><ul><li>任何正整数都可以表示为若干个2的幂的和</li><li>这种特性使得我们可以用O(log n)个节点表示任意区间</li></ul></li><li><p><strong>区间管理</strong>：</p><ul><li>每个节点管理的区间长度是2的幂</li><li>这种设计使得更新和查询操作都非常高效</li></ul></li></ol><h2 class="content-header" id="二叉搜索树在磁盘上的问题"><a href="#二叉搜索树在磁盘上的问题" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>二叉搜索树在磁盘上的问题</h2><p>让我们先从不适合的方法开始：二叉搜索树（BST）在磁盘上。</p><p>在内存中，二叉搜索树非常出色。每个节点存储一个键值，有两个子节点（左和右）。左子树中的键值较小，右子树中的键值较大。找到一个键值需要O(log₂ n)次比较。</p><p><img alt="二叉搜索树" src="https://substackcdn.com/image/fetch/$s_!kIqJ!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe9c04393-d2fb-47f0-93d7-d2724edbda56_705x502.png"/></p><p><em>图1：有7个节点的二叉搜索树。查找键值11需要3次比较：15 → 7 → 11。</em></p><p>对于100万条记录，平衡的BST高度为log₂(1,000,000) ≈ 20。也就是说，找到任何记录需要20次比较。</p><p><strong>在内存中，这很快。</strong> 每次比较是指针解引用（现代CPU上约0.0001毫秒）。总查找时间：0.002毫秒。</p><p><strong>在磁盘上，这是灾难性的。</strong> 原因如下：</p><h3 class="content-header" id="磁盘io很昂贵"><a href="#磁盘io很昂贵" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>磁盘I/O很昂贵</h3><p>磁盘访问的最小单位是块（通常是4KB到16KB）。要从磁盘读取单个字节，你必须读取包含它的整个块。</p><p><strong>磁盘访问时间：</strong></p><ul><li>RAM访问：0.0001毫秒</li><li>SSD访问：0.1毫秒</li><li>HDD访问：10毫秒</li><li>磁盘比RAM慢100-100,000倍</li></ul><h3 class="content-header" id="二叉树的灾难"><a href="#二叉树的灾难" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>二叉树的灾难</h3><p>在磁盘上使用BST时，每个节点存储在单独的磁盘块中。从父节点遍历到子节点需要磁盘寻道。</p><p>对于100万条记录：</p><ul><li>高度：20个节点</li><li>磁盘寻道：20次</li><li>HDD上时间：20 × 10毫秒 = <strong>200毫秒</strong></li><li>SSD上时间：20 × 0.1毫秒 = <strong>2毫秒</strong></li></ul><p>对于SSD来说还可以接受，但对HDD来说太糟糕了。随着树的增长，情况会变得更糟。</p><p>对于10亿条记录：</p><ul><li>高度：30个节点</li><li>HDD上时间：30 × 10毫秒 = <strong>300毫秒</strong></li><li>SSD上时间：30 × 0.1毫秒 = <strong>3毫秒</strong></li></ul><p><strong>根本问题：</strong> BST的扇出太低（每个节点只有2个子节点）。我们需要每个节点有更多的子节点来减少树的高度。</p><h3 class="content-header" id="为什么不直接平衡树"><a href="#为什么不直接平衡树" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>为什么不直接平衡树？</h3><p>你可能会想：&quot;直接保持树的平衡！&quot; 红黑树和AVL树就是这样做的。</p><p>问题不只是树的高度——还有维护成本。平衡需要旋转节点和更新指针。在内存中，这很便宜（几次指针写入）。在磁盘上，这很昂贵：</p><ol><li>从磁盘读取节点（4KB块）</li><li>在内存中修改节点</li><li>将修改后的节点写回磁盘（4KB块）</li><li>更新父指针（更多磁盘I/O）</li></ol><p>对于频繁插入和删除的树，不断的重新平衡会扼杀性能。我们需要一个：</p><ul><li>具有高扇出（每个节点有多个子节点）→ 减少高度</li><li>需要很少的重新平衡 → 减少I/O开销</li></ul><p>的数据结构。</p><p>那个数据结构就是B树。</p><h2 class="content-header" id="什么是b树"><a href="#什么是b树" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>什么是B树？</h2><h3 class="content-header" id="b树结构"><a href="#b树结构" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>B树结构</h3><p>B树是自平衡树，为磁盘访问优化。与2个子节点的二叉树不同，B树节点有<strong>成百上千</strong>个子节点。</p><p><strong>关键思想：</strong> 每个B树节点装入一个磁盘块（4KB到16KB）。既然我们必须读取整个块，那就尽可能多地打包键值对。</p><h3 class="content-header" id="b树结构-1"><a href="#b树结构-1" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>B树结构</h3><p>B树节点存储：</p><ul><li><strong>N个键值</strong>（排序的）</li><li><strong>N + 1个指针</strong> 指向子节点</li></ul><p>每个键值充当分隔符：child[i]中的键值 &lt; key[i] &lt; child[i+1]中的键值。</p><p><img alt="B树结构" src="https://substackcdn.com/image/fetch/$s_!txJ0!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2f0cbd7f-e98d-4fce-ae43-4945e46bf095_1582x502.png"/></p><p><em>图2：扇出约100的B树。根节点有2个键和3个子节点。内部节点有4个键和5个子节点。叶子节点包含实际数据。</em></p><h3 class="content-header" id="b树层次结构"><a href="#b树层次结构" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>B树层次结构</h3><p>B树有三种类型的节点：</p><p><strong>根节点：</strong> 树的顶部。总只有一个根。</p><p><strong>内部节点：</strong> 指导搜索的中间层。它们存储分隔键和指针，但不存储实际数据。</p><p><strong>叶子节点：</strong> 包含实际数据（键值对）的底层。所有叶子都在同一深度。</p><p>这是<strong>B+树</strong>（最常见的变种）。B+树只在叶子存储数据，而B树也可以在内部节点存储数据。每个主流数据库都使用B+树，但为了简单称之为&quot;B树&quot;。</p><h3 class="content-header" id="为什么高扇出很重要"><a href="#为什么高扇出很重要" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>为什么高扇出很重要</h3><p><strong>二叉树（扇出 = 2）：</strong></p><ul><li>100万记录 → 高度 = 20</li><li>10亿记录 → 高度 = 30</li></ul><p><strong>B树（扇出 = 100）：</strong></p><ul><li>100万记录 → 高度 = 3（因为100³ = 1,000,000）</li><li>10亿记录 → 高度 = 5（因为100⁵ = 10,000,000,000）</li></ul><p><strong>B树（扇出 = 1000）：</strong></p><ul><li>100万记录 → 高度 = 2（因为1000² = 1,000,000）</li><li>10亿记录 → 高度 = 3（因为1000³ = 1,000,000,000）</li></ul><p><img alt="扇出对比" src="https://substackcdn.com/image/fetch/$s_!KWBT!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe4416acc-dcc2-4af7-80f6-a56aa8c8a9c6_1240x454.png"/></p><p><strong>高扇出 = 更少的磁盘寻道 = 更快的查询。</strong></p><h2 class="content-header" id="b树查找算法"><a href="#b树查找算法" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>B树查找算法</h2><p>在B树中查找键值是从根到叶子的遍历，在每个节点进行二分查找。</p><p><strong>算法：</strong></p><ol><li>从根节点开始</li><li>在当前节点内二分查找键值，找到分隔键值范围</li><li>跟随相应的子节点指针</li><li>重复直到到达叶子节点</li><li>在叶子中，要么找到键值，要么得出不存在的结论</li></ol><p><strong>时间复杂度：</strong></p><ul><li>树高度：O(log_fanout n)</li><li>每个节点二分查找：O(log₂ fanout)</li><li>总计：O(log n)</li></ul><p><strong>示例：</strong> 在扇出100、100万记录的B树中查找键值72。</p><div class="relative"><pre><code class="code-highlight language-js"><span class="code-line">步骤<span class="token number">1</span>：读取根节点（<span class="token number">1</span>次磁盘<span class="token constant">I</span><span class="token operator">/</span><span class="token constant">O</span>）
</span><span class="code-line">  键值：<span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">,</span> <span class="token operator spread">...</span><span class="token punctuation">]</span>
</span><span class="code-line">  <span class="token number">72</span>在<span class="token number">50</span>和<span class="token number">100</span>之间
</span><span class="code-line">  跟随子节点指针<span class="token number">2</span>
</span><span class="code-line">
</span><span class="code-line">步骤<span class="token number">2</span>：读取内部节点（<span class="token number">1</span>次磁盘<span class="token constant">I</span><span class="token operator">/</span><span class="token constant">O</span>）
</span><span class="code-line">  键值：<span class="token punctuation">[</span><span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">65</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token operator spread">...</span><span class="token punctuation">]</span>
</span><span class="code-line">  <span class="token number">72</span>在<span class="token number">70</span>和<span class="token number">75</span>之间
</span><span class="code-line">  跟随子节点指针<span class="token number">5</span>
</span><span class="code-line">
</span><span class="code-line">步骤<span class="token number">3</span>：读取叶子节点（<span class="token number">1</span>次磁盘<span class="token constant">I</span><span class="token operator">/</span><span class="token constant">O</span>）
</span><span class="code-line">  键值：<span class="token punctuation">[</span><span class="token number">71</span><span class="token punctuation">,</span> <span class="token number">72</span><span class="token punctuation">,</span> <span class="token number">73</span><span class="token punctuation">,</span> <span class="token number">74</span><span class="token punctuation">]</span>
</span><span class="code-line">  找到！返回键值<span class="token number">72</span>的值
</span><span class="code-line">
</span><span class="code-line">总计：<span class="token number">3</span>次磁盘<span class="token constant">I</span><span class="token operator">/</span><span class="token constant">O</span>操作 <span class="token operator">=</span> <span class="token constant">HDD</span>上<span class="token number">30</span>毫秒，<span class="token constant">SSD</span>上<span class="token number">0.3</span>毫秒
</span></code></pre></div><h3 class="content-header" id="python中的工作实现"><a href="#python中的工作实现" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Python中的工作实现</h3><p>让我们用Python实现一个简化但功能完整的B树。</p><div class="relative"><pre><code class="code-highlight language-python"><span class="code-line"><span class="token keyword">from</span> typing <span class="token keyword">import</span> List<span class="token punctuation">,</span> Optional
</span><span class="code-line"><span class="token keyword">from</span> dataclasses <span class="token keyword">import</span> dataclass<span class="token punctuation">,</span> field
</span><span class="code-line">
</span><span class="code-line">
</span><span class="code-line"><span class="token punctuation annotation decorator">@dataclass</span>
</span><span class="code-line"><span class="token keyword">class</span> <span class="token class-name">BTreeNode</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token string triple-quoted-string">&quot;&quot;&quot;
</span></span><span class="code-line"><span class="token string triple-quoted-string">    B树节点，存储键值和子节点指针。
</span></span><span class="code-line"><span class="token string triple-quoted-string">
</span></span><span class="code-line"><span class="token string triple-quoted-string">    属性:
</span></span><span class="code-line"><span class="token string triple-quoted-string">        keys: 该节点中排序后的键值列表
</span></span><span class="code-line"><span class="token string triple-quoted-string">        children: 子节点指针列表（长度 = len(keys) + 1）
</span></span><span class="code-line"><span class="token string triple-quoted-string">        is_leaf: 是否为叶子节点（无子节点）
</span></span><span class="code-line"><span class="token string triple-quoted-string">
</span></span><span class="code-line"><span class="token string triple-quoted-string">    不变量:
</span></span><span class="code-line"><span class="token string triple-quoted-string">        - len(children) == len(keys) + 1（对于内部节点）
</span></span><span class="code-line"><span class="token string triple-quoted-string">        - 所有键值都是排序的
</span></span><span class="code-line"><span class="token string triple-quoted-string">        - children[i]中的键 &lt; keys[i] &lt; children[i+1]中的键
</span></span><span class="code-line"><span class="token string triple-quoted-string">    &quot;&quot;&quot;</span>
</span><span class="code-line">    keys<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span> <span class="token operator">=</span> field<span class="token punctuation">(</span>default_factory<span class="token operator">=</span><span class="token builtin">list</span><span class="token punctuation">)</span>
</span><span class="code-line">    children<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token string">&#x27;BTreeNode&#x27;</span><span class="token punctuation">]</span> <span class="token operator">=</span> field<span class="token punctuation">(</span>default_factory<span class="token operator">=</span><span class="token builtin">list</span><span class="token punctuation">)</span>
</span><span class="code-line">    is_leaf<span class="token punctuation">:</span> <span class="token builtin">bool</span> <span class="token operator">=</span> <span class="token boolean">True</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">def</span> <span class="token function">__repr__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f&quot;BTreeNode(keys=</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>keys<span class="token punctuation">}</span></span><span class="token string">, is_leaf=</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>is_leaf<span class="token punctuation">}</span></span><span class="token string">)&quot;</span></span>
</span><span class="code-line">
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">class</span> <span class="token class-name">BTree</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token string triple-quoted-string">&quot;&quot;&quot;
</span></span><span class="code-line"><span class="token string triple-quoted-string">    B树实现，可配置阶数（最大子节点数）。
</span></span><span class="code-line"><span class="token string triple-quoted-string">
</span></span><span class="code-line"><span class="token string triple-quoted-string">    属性:
</span></span><span class="code-line"><span class="token string triple-quoted-string">        order: 每个节点的最大子节点数（扇出）
</span></span><span class="code-line"><span class="token string triple-quoted-string">        root: 树的根节点
</span></span><span class="code-line"><span class="token string triple-quoted-string">
</span></span><span class="code-line"><span class="token string triple-quoted-string">    属性:
</span></span><span class="code-line"><span class="token string triple-quoted-string">        - 每个节点最多有 (order - 1) 个键
</span></span><span class="code-line"><span class="token string triple-quoted-string">        - 每个非根节点至少有 (order // 2 - 1) 个键
</span></span><span class="code-line"><span class="token string triple-quoted-string">        - 树高度是 O(log_order n)
</span></span><span class="code-line"><span class="token string triple-quoted-string">
</span></span><span class="code-line"><span class="token string triple-quoted-string">    时间复杂度:
</span></span><span class="code-line"><span class="token string triple-quoted-string">        - 查找: O(log n)
</span></span><span class="code-line"><span class="token string triple-quoted-string">        - 插入: O(log n)
</span></span><span class="code-line"><span class="token string triple-quoted-string">        - 删除: O(log n)
</span></span><span class="code-line"><span class="token string triple-quoted-string">
</span></span><span class="code-line"><span class="token string triple-quoted-string">    空间复杂度: O(n)
</span></span><span class="code-line"><span class="token string triple-quoted-string">    &quot;&quot;&quot;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> order<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token string triple-quoted-string">&quot;&quot;&quot;
</span></span><span class="code-line"><span class="token string triple-quoted-string">        初始化B树。
</span></span><span class="code-line"><span class="token string triple-quoted-string">
</span></span><span class="code-line"><span class="token string triple-quoted-string">        参数:
</span></span><span class="code-line"><span class="token string triple-quoted-string">            order: 每个节点的最大子节点数（扇出）。
</span></span><span class="code-line"><span class="token string triple-quoted-string">                   更高的阶数 = 更少的层数但更大的节点。
</span></span><span class="code-line"><span class="token string triple-quoted-string">                   基于磁盘存储的典型值：100-1000。
</span></span><span class="code-line"><span class="token string triple-quoted-string">        &quot;&quot;&quot;</span>
</span><span class="code-line">        <span class="token keyword">if</span> order <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">&quot;阶数必须至少为3&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">        self<span class="token punctuation">.</span>order <span class="token operator">=</span> order
</span><span class="code-line">        self<span class="token punctuation">.</span>root <span class="token operator">=</span> BTreeNode<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">def</span> <span class="token function">search</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Optional<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token string triple-quoted-string">&quot;&quot;&quot;
</span></span><span class="code-line"><span class="token string triple-quoted-string">        在B树中搜索键值。
</span></span><span class="code-line"><span class="token string triple-quoted-string">
</span></span><span class="code-line"><span class="token string triple-quoted-string">        参数:
</span></span><span class="code-line"><span class="token string triple-quoted-string">            key: 要搜索的键值
</span></span><span class="code-line"><span class="token string triple-quoted-string">
</span></span><span class="code-line"><span class="token string triple-quoted-string">        返回:
</span></span><span class="code-line"><span class="token string triple-quoted-string">            如果找到返回键值，否则返回None
</span></span><span class="code-line"><span class="token string triple-quoted-string">
</span></span><span class="code-line"><span class="token string triple-quoted-string">        时间复杂度: O(log n)，n为键的数量
</span></span><span class="code-line"><span class="token string triple-quoted-string">        &quot;&quot;&quot;</span>
</span><span class="code-line">        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_search_recursive<span class="token punctuation">(</span>self<span class="token punctuation">.</span>root<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">def</span> <span class="token function">_search_recursive</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> node<span class="token punctuation">:</span> BTreeNode<span class="token punctuation">,</span> key<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Optional<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token string triple-quoted-string">&quot;&quot;&quot;
</span></span><span class="code-line"><span class="token string triple-quoted-string">        从节点开始递归搜索键值。
</span></span><span class="code-line"><span class="token string triple-quoted-string">
</span></span><span class="code-line"><span class="token string triple-quoted-string">        使用节点内的二分查找找到正确的子节点。
</span></span><span class="code-line"><span class="token string triple-quoted-string">        &quot;&quot;&quot;</span>
</span><span class="code-line">        <span class="token comment"># 节点内二分查找</span>
</span><span class="code-line">        i <span class="token operator">=</span> self<span class="token punctuation">.</span>_binary_search<span class="token punctuation">(</span>node<span class="token punctuation">.</span>keys<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token comment"># 找到精确匹配</span>
</span><span class="code-line">        <span class="token keyword">if</span> i <span class="token operator">&lt;</span> <span class="token builtin">len</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>keys<span class="token punctuation">)</span> <span class="token keyword">and</span> node<span class="token punctuation">.</span>keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> key<span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token keyword">return</span> key
</span><span class="code-line">
</span><span class="code-line">        <span class="token comment"># 到达叶子节点但未找到</span>
</span><span class="code-line">        <span class="token keyword">if</span> node<span class="token punctuation">.</span>is_leaf<span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token keyword">return</span> <span class="token boolean">None</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token comment"># 递归到适当的子节点</span>
</span><span class="code-line">        <span class="token comment"># （实际实现中，这会是磁盘I/O）</span>
</span><span class="code-line">        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_search_recursive<span class="token punctuation">(</span>node<span class="token punctuation">.</span>children<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">def</span> <span class="token function">_binary_search</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> keys<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">,</span> key<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">int</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token string triple-quoted-string">&quot;&quot;&quot;
</span></span><span class="code-line"><span class="token string triple-quoted-string">        二分查找键值的插入位置。
</span></span><span class="code-line"><span class="token string triple-quoted-string">
</span></span><span class="code-line"><span class="token string triple-quoted-string">        返回:
</span></span><span class="code-line"><span class="token string triple-quoted-string">            索引i，使得keys[i-1] &lt; key &lt;= keys[i]
</span></span><span class="code-line"><span class="token string triple-quoted-string">
</span></span><span class="code-line"><span class="token string triple-quoted-string">        时间复杂度: O(log m)，m为节点中的键数量
</span></span><span class="code-line"><span class="token string triple-quoted-string">        &quot;&quot;&quot;</span>
</span><span class="code-line">        left<span class="token punctuation">,</span> right <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>keys<span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token keyword">while</span> left <span class="token operator">&lt;</span> right<span class="token punctuation">:</span>
</span><span class="code-line">            mid <span class="token operator">=</span> <span class="token punctuation">(</span>left <span class="token operator">+</span> right<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span>
</span><span class="code-line">            <span class="token keyword">if</span> keys<span class="token punctuation">[</span>mid<span class="token punctuation">]</span> <span class="token operator">&lt;</span> key<span class="token punctuation">:</span>
</span><span class="code-line">                left <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>
</span><span class="code-line">            <span class="token keyword">else</span><span class="token punctuation">:</span>
</span><span class="code-line">                right <span class="token operator">=</span> mid
</span><span class="code-line">        <span class="token keyword">return</span> left
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">def</span> <span class="token function">insert</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token string triple-quoted-string">&quot;&quot;&quot;
</span></span><span class="code-line"><span class="token string triple-quoted-string">        向B树插入键值。
</span></span><span class="code-line"><span class="token string triple-quoted-string">
</span></span><span class="code-line"><span class="token string triple-quoted-string">        参数:
</span></span><span class="code-line"><span class="token string triple-quoted-string">            key: 要插入的键值
</span></span><span class="code-line"><span class="token string triple-quoted-string">
</span></span><span class="code-line"><span class="token string triple-quoted-string">        时间复杂度: O(log n)
</span></span><span class="code-line"><span class="token string triple-quoted-string">
</span></span><span class="code-line"><span class="token string triple-quoted-string">        算法:
</span></span><span class="code-line"><span class="token string triple-quoted-string">            1. 找到合适的叶子节点
</span></span><span class="code-line"><span class="token string triple-quoted-string">            2. 将键值插入叶子
</span></span><span class="code-line"><span class="token string triple-quoted-string">            3. 如果叶子溢出（键值太多），分裂它
</span></span><span class="code-line"><span class="token string triple-quoted-string">            4. 如果需要，将分裂向上传播
</span></span><span class="code-line"><span class="token string triple-quoted-string">        &quot;&quot;&quot;</span>
</span><span class="code-line">        root <span class="token operator">=</span> self<span class="token punctuation">.</span>root
</span><span class="code-line">
</span><span class="code-line">        <span class="token comment"># 如果根节点满了，分裂它并创建新根</span>
</span><span class="code-line">        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span>keys<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> self<span class="token punctuation">.</span>order <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">:</span>
</span><span class="code-line">            new_root <span class="token operator">=</span> BTreeNode<span class="token punctuation">(</span>is_leaf<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
</span><span class="code-line">            new_root<span class="token punctuation">.</span>children<span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">.</span>root<span class="token punctuation">)</span>
</span><span class="code-line">            self<span class="token punctuation">.</span>_split_child<span class="token punctuation">(</span>new_root<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
</span><span class="code-line">            self<span class="token punctuation">.</span>root <span class="token operator">=</span> new_root
</span><span class="code-line">
</span><span class="code-line">        self<span class="token punctuation">.</span>_insert_non_full<span class="token punctuation">(</span>self<span class="token punctuation">.</span>root<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">def</span> <span class="token function">_insert_non_full</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> node<span class="token punctuation">:</span> BTreeNode<span class="token punctuation">,</span> key<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token string triple-quoted-string">&quot;&quot;&quot;
</span></span><span class="code-line"><span class="token string triple-quoted-string">        向未满的节点插入键值。
</span></span><span class="code-line"><span class="token string triple-quoted-string">
</span></span><span class="code-line"><span class="token string triple-quoted-string">        递归地找到正确的叶子节点并插入。
</span></span><span class="code-line"><span class="token string triple-quoted-string">        &quot;&quot;&quot;</span>
</span><span class="code-line">        i <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>keys<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token keyword">if</span> node<span class="token punctuation">.</span>is_leaf<span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token comment"># 插入到排序位置</span>
</span><span class="code-line">            node<span class="token punctuation">.</span>keys<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">)</span>  <span class="token comment"># 腾出空间</span>
</span><span class="code-line">            <span class="token keyword">while</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token keyword">and</span> key <span class="token operator">&lt;</span> node<span class="token punctuation">.</span>keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">:</span>
</span><span class="code-line">                node<span class="token punctuation">.</span>keys<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> node<span class="token punctuation">.</span>keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
</span><span class="code-line">                i <span class="token operator">-=</span> <span class="token number">1</span>
</span><span class="code-line">            node<span class="token punctuation">.</span>keys<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> key
</span><span class="code-line">        <span class="token keyword">else</span><span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token comment"># 找到要插入的子节点</span>
</span><span class="code-line">            <span class="token keyword">while</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token keyword">and</span> key <span class="token operator">&lt;</span> node<span class="token punctuation">.</span>keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">:</span>
</span><span class="code-line">                i <span class="token operator">-=</span> <span class="token number">1</span>
</span><span class="code-line">            i <span class="token operator">+=</span> <span class="token number">1</span>
</span><span class="code-line">
</span><span class="code-line">            <span class="token comment"># 如果子节点满了，先分裂它</span>
</span><span class="code-line">            <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>children<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>keys<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> self<span class="token punctuation">.</span>order <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">:</span>
</span><span class="code-line">                self<span class="token punctuation">.</span>_split_child<span class="token punctuation">(</span>node<span class="token punctuation">,</span> i<span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token keyword">if</span> key <span class="token operator">&gt;</span> node<span class="token punctuation">.</span>keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">:</span>
</span><span class="code-line">                    i <span class="token operator">+=</span> <span class="token number">1</span>
</span><span class="code-line">
</span><span class="code-line">            self<span class="token punctuation">.</span>_insert_non_full<span class="token punctuation">(</span>node<span class="token punctuation">.</span>children<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">def</span> <span class="token function">_split_child</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> parent<span class="token punctuation">:</span> BTreeNode<span class="token punctuation">,</span> child_index<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token string triple-quoted-string">&quot;&quot;&quot;
</span></span><span class="code-line"><span class="token string triple-quoted-string">        分裂满的子节点为两个节点。
</span></span><span class="code-line"><span class="token string triple-quoted-string">
</span></span><span class="code-line"><span class="token string triple-quoted-string">        参数:
</span></span><span class="code-line"><span class="token string triple-quoted-string">            parent: 包含满子节点的父节点
</span></span><span class="code-line"><span class="token string triple-quoted-string">            child_index: 满子节点在父节点children中的索引
</span></span><span class="code-line"><span class="token string triple-quoted-string">
</span></span><span class="code-line"><span class="token string triple-quoted-string">        算法:
</span></span><span class="code-line"><span class="token string triple-quoted-string">            1. 创建新的兄弟节点
</span></span><span class="code-line"><span class="token string triple-quoted-string">            2. 将满子节点的一半键值移动到兄弟节点
</span></span><span class="code-line"><span class="token string triple-quoted-string">            3. 将中间键值提升到父节点
</span></span><span class="code-line"><span class="token string triple-quoted-string">            4. 更新父节点的子节点列表
</span></span><span class="code-line"><span class="token string triple-quoted-string">        &quot;&quot;&quot;</span>
</span><span class="code-line">        full_child <span class="token operator">=</span> parent<span class="token punctuation">.</span>children<span class="token punctuation">[</span>child_index<span class="token punctuation">]</span>
</span><span class="code-line">        new_sibling <span class="token operator">=</span> BTreeNode<span class="token punctuation">(</span>is_leaf<span class="token operator">=</span>full_child<span class="token punctuation">.</span>is_leaf<span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">        mid <span class="token operator">=</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>order <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token comment"># 将一半键值移动到新兄弟节点</span>
</span><span class="code-line">        new_sibling<span class="token punctuation">.</span>keys <span class="token operator">=</span> full_child<span class="token punctuation">.</span>keys<span class="token punctuation">[</span>mid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
</span><span class="code-line">        full_child<span class="token punctuation">.</span>keys <span class="token operator">=</span> full_child<span class="token punctuation">.</span>keys<span class="token punctuation">[</span><span class="token punctuation">:</span>mid<span class="token punctuation">]</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token comment"># 如果不是叶子节点，移动一半子节点</span>
</span><span class="code-line">        <span class="token keyword">if</span> <span class="token keyword">not</span> full_child<span class="token punctuation">.</span>is_leaf<span class="token punctuation">:</span>
</span><span class="code-line">            new_sibling<span class="token punctuation">.</span>children <span class="token operator">=</span> full_child<span class="token punctuation">.</span>children<span class="token punctuation">[</span>mid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
</span><span class="code-line">            full_child<span class="token punctuation">.</span>children <span class="token operator">=</span> full_child<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token punctuation">:</span>mid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token comment"># 将中间键值提升到父节点</span>
</span><span class="code-line">        promoted_key <span class="token operator">=</span> full_child<span class="token punctuation">.</span>keys<span class="token punctuation">[</span>mid<span class="token punctuation">]</span>
</span><span class="code-line">        parent<span class="token punctuation">.</span>keys<span class="token punctuation">.</span>insert<span class="token punctuation">(</span>child_index<span class="token punctuation">,</span> promoted_key<span class="token punctuation">)</span>
</span><span class="code-line">        parent<span class="token punctuation">.</span>children<span class="token punctuation">.</span>insert<span class="token punctuation">(</span>child_index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> new_sibling<span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">def</span> <span class="token function">print_tree</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> node<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>BTreeNode<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span> level<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token string triple-quoted-string">&quot;&quot;&quot;
</span></span><span class="code-line"><span class="token string triple-quoted-string">        打印树结构用于调试。
</span></span><span class="code-line"><span class="token string triple-quoted-string">        &quot;&quot;&quot;</span>
</span><span class="code-line">        <span class="token keyword">if</span> node <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
</span><span class="code-line">            node <span class="token operator">=</span> self<span class="token punctuation">.</span>root
</span><span class="code-line">
</span><span class="code-line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;  &quot;</span> <span class="token operator">*</span> level <span class="token operator">+</span> <span class="token string-interpolation"><span class="token string">f&quot;Level </span><span class="token interpolation"><span class="token punctuation">{</span>level<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>node<span class="token punctuation">.</span>keys<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token keyword">if</span> <span class="token keyword">not</span> node<span class="token punctuation">.</span>is_leaf<span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token keyword">for</span> child <span class="token keyword">in</span> node<span class="token punctuation">.</span>children<span class="token punctuation">:</span>
</span><span class="code-line">                self<span class="token punctuation">.</span>print_tree<span class="token punctuation">(</span>child<span class="token punctuation">,</span> level <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># 使用示例</span>
</span><span class="code-line"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token comment"># 创建阶数为5的B树（每个节点最多4个键）</span>
</span><span class="code-line">    btree <span class="token operator">=</span> BTree<span class="token punctuation">(</span>order<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment"># 插入键值</span>
</span><span class="code-line">    keys <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">]</span>
</span><span class="code-line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;插入键值:&quot;</span><span class="token punctuation">,</span> keys<span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">for</span> key <span class="token keyword">in</span> keys<span class="token punctuation">:</span>
</span><span class="code-line">        btree<span class="token punctuation">.</span>insert<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\nB树结构:&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">    btree<span class="token punctuation">.</span>print_tree<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment"># 搜索键值</span>
</span><span class="code-line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n搜索键值:&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">for</span> search_key <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
</span><span class="code-line">        result <span class="token operator">=</span> btree<span class="token punctuation">.</span>search<span class="token punctuation">(</span>search_key<span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token keyword">if</span> result<span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;  键 </span><span class="token interpolation"><span class="token punctuation">{</span>search_key<span class="token punctuation">}</span></span><span class="token string">: 找到&quot;</span></span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token keyword">else</span><span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;  键 </span><span class="token interpolation"><span class="token punctuation">{</span>search_key<span class="token punctuation">}</span></span><span class="token string">: 未找到&quot;</span></span><span class="token punctuation">)</span>
</span></code></pre></div><p><strong>输出：</strong></p><div class="relative"><pre><code class="code-highlight language-js"><span class="code-line"><span class="token literal-property property">插入键值</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">]</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token constant">B</span><span class="token literal-property property">树结构</span><span class="token operator">:</span>
</span><span class="code-line"><span class="token maybe-class-name">Level</span> <span class="token number">0</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">]</span>
</span><span class="code-line">  <span class="token maybe-class-name">Level</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span>
</span><span class="code-line">  <span class="token maybe-class-name">Level</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">]</span>
</span><span class="code-line">  <span class="token maybe-class-name">Level</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">]</span>
</span><span class="code-line">  <span class="token maybe-class-name">Level</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">]</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token literal-property property">搜索键值</span><span class="token operator">:</span>
</span><span class="code-line">  键 <span class="token number">6</span><span class="token operator">:</span> 找到
</span><span class="code-line">  键 <span class="token number">16</span><span class="token operator">:</span> 找到
</span><span class="code-line">  键 <span class="token number">21</span><span class="token operator">:</span> 找到
</span><span class="code-line">  键 <span class="token number">100</span><span class="token operator">:</span> 未找到
</span></code></pre></div><p><strong>为什么这个实现有效：</strong></p><ul><li>每个节点存储最多 <code class="custom-code">order - 1</code> 个键</li><li>分裂操作维护B树的不变量</li><li>节点内二分查找减少比较</li><li>树高度保持对数</li></ul><h2 class="content-header" id="b树节点分裂"><a href="#b树节点分裂" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>B树节点分裂</h2><p>当你向满的叶子节点插入键值时，节点必须分裂。</p><p><strong>分裂算法：</strong></p><ol><li>找到满节点的中点</li><li>创建新的兄弟节点</li><li>将一半键值移动到新节点</li><li>将中间键值提升到父节点</li><li>如果父节点满了，递归地分裂它</li></ol><p>当分裂传播到根节点时：</p><ul><li>根节点分裂为两个节点</li><li>创建新根节点，包含一个键值（从旧根提升的）</li><li>树高增加1</li></ul><p>这是B树高度增加的唯一方式。<strong>B树从叶子向上生长，而不是从根向下生长。</strong></p><h2 class="content-header" id="b树的性能特征"><a href="#b树的性能特征" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>B树的性能特征</h2><h3 class="content-header" id="查找复杂度"><a href="#查找复杂度" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>查找复杂度</h3><p><strong>时间复杂度</strong>：O(log n)</p><p>对于n个键值、扇出f的树：</p><ul><li>树高度：log_f(n)</li><li>每个节点二分查找：log₂(f)</li><li>总比较次数：log_f(n) × log₂(f) = O(log n)</li></ul><p><strong>磁盘I/O</strong>：log_f(n) 次磁盘读取（每层一次）</p><h3 class="content-header" id="插入复杂度"><a href="#插入复杂度" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>插入复杂度</h3><p><strong>时间复杂度</strong>：O(log n)</p><ul><li>查找插入位置：O(log n)</li><li>插入到叶子：O(f) 移动键值</li><li>必要时分裂：O(f) 移动键值</li><li>分裂向上传播：最坏情况O(log n) 层</li></ul><p><strong>磁盘I/O</strong>：O(log n) 次磁盘读取 + O(log n) 次磁盘写入</p><h3 class="content-header" id="删除复杂度"><a href="#删除复杂度" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>删除复杂度</h3><p><strong>时间复杂度</strong>：O(log n)</p><ul><li>查找键值：O(log n)</li><li>从叶子删除：O(f) 移动键值</li><li>必要时合并：O(f) 移动键值</li><li>合并向上传播：最坏情况O(log n) 层</li></ul><p><strong>磁盘I/O</strong>：O(log n) 次磁盘读取 + O(log n) 次磁盘写入</p><h3 class="content-header" id="空间复杂度"><a href="#空间复杂度" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>空间复杂度</h3><p><strong>空间</strong>：O(n)</p><p>每个键值存储一次。内部节点增加开销（指针和分隔键），但这通常是数据大小的10-20%。</p><p><strong>占用率</strong>：节点通常是50-90%满。更高的扇出提高空间效率，因为指针开销成比例地变小。</p><h2 class="content-header" id="真实世界的b树应用"><a href="#真实世界的b树应用" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>真实世界的B树应用</h2><p>每个主要数据库都使用B树（或B+树）作为索引。</p><h3 class="content-header" id="mysql-innodb"><a href="#mysql-innodb" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>MySQL InnoDB</h3><p>InnoDB使用B+树作为：</p><ul><li><strong>主键索引</strong>（聚簇索引）：叶子节点存储实际行数据</li><li><strong>二级索引</strong>：叶子节点存储指向主键的指针</li></ul><p><strong>InnoDB B树配置</strong>：</p><ul><li>页大小：16KB（默认）</li><li>扇出：约100-200，取决于键值大小</li><li>100万行数据的树高：3-4层</li></ul><p><strong>示例：</strong></p><div class="relative"><pre><code class="code-highlight language-sql"><span class="code-line"><span class="token comment">-- 创建带主键的表</span>
</span><span class="code-line"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> users <span class="token punctuation">(</span>
</span><span class="code-line">    id <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
</span><span class="code-line">    name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">    email <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">-- 主键自动创建聚簇B+树索引</span>
</span><span class="code-line"><span class="token comment">-- 叶子节点包含实际行数据</span>
</span><span class="code-line"><span class="token comment">-- 树结构：id=1与name和email一起存储在叶子中</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">-- 在email上创建二级索引</span>
</span><span class="code-line"><span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> idx_email <span class="token keyword">ON</span> users<span class="token punctuation">(</span>email<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">-- 二级索引是单独的B+树</span>
</span><span class="code-line"><span class="token comment">-- 叶子节点包含email → id映射</span>
</span><span class="code-line"><span class="token comment">-- 要获取完整行：在idx_email中查找email → 获取id → 查找主键中的id</span>
</span></code></pre></div><h3 class="content-header" id="postgresql"><a href="#postgresql" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>PostgreSQL</h3><p>PostgreSQL默认使用B树作为索引类型。</p><p><strong>PostgreSQL B树配置</strong>：</p><ul><li>页大小：8KB（默认）</li><li>扇出：约50-100，取决于键值大小</li><li>支持多种索引类型，但B树是默认</li></ul><h3 class="content-header" id="其他数据库系统"><a href="#其他数据库系统" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>其他数据库系统</h3><ul><li><strong>SQLite</strong>：使用B树存储表和索引</li><li><strong>MongoDB WiredTiger</strong>：使用B树作为索引</li><li><strong>Oracle</strong>、<strong>SQL Server</strong>：都使用B树的变体</li></ul><h2 class="content-header" id="权衡和限制"><a href="#权衡和限制" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>权衡和限制</h2><p>B树并不完美。以下是它们遇到的困难：</p><h3 class="content-header" id="写放大"><a href="#写放大" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>写放大</h3><p>每次插入都可能触发一直传播到根的分裂。最坏情况下：</p><ul><li>插入1个键 → 分裂叶子 → 分裂父节点 → 分裂祖父节点 → 分裂根节点</li><li>1个逻辑写入变成4+个物理写入</li></ul><p><strong>示例：</strong> 插入100万个键值，频繁分裂：</p><ul><li>逻辑写入：100万</li><li>物理写入（带分裂）：200-300万</li><li>写放大：2-3倍</li></ul><p><strong>替代方案：</strong> LSM树（Log-Structured Merge Trees），被RocksDB、Cassandra使用。</p><h3 class="content-header" id="非顺序键值上的范围查询"><a href="#非顺序键值上的范围查询" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>非顺序键值上的范围查询</h3><p>B树为索引键值上的范围查询进行了优化，但在多列范围查询方面有困难。</p><p><strong>示例：</strong></p><div class="relative"><pre><code class="code-highlight language-sql"><span class="code-line"><span class="token comment">-- 快速：索引列上的范围查询</span>
</span><span class="code-line"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> orders <span class="token keyword">WHERE</span> order_date <span class="token operator">BETWEEN</span> <span class="token string">&#x27;2024-01-01&#x27;</span> <span class="token operator">AND</span> <span class="token string">&#x27;2024-12-31&#x27;</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token comment">-- B树顺序遍历叶子节点（叶子节点是链接的）</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">-- 慢：非索引列上的范围查询</span>
</span><span class="code-line"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> orders <span class="token keyword">WHERE</span> total_amount <span class="token operator">BETWEEN</span> <span class="token number">100</span> <span class="token operator">AND</span> <span class="token number">200</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token comment">-- 必须扫描整个表（total_amount上没有索引）</span>
</span></code></pre></div><h3 class="content-header" id="缓存的内存开销"><a href="#缓存的内存开销" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>缓存的内存开销</h3><p>为了避免磁盘I/O，数据库在内存中缓存频繁访问的B树节点。对于大型数据库：</p><ul><li>10亿条记录</li><li>树高：4层</li><li>内部节点：约100万个</li><li>缓存大小：约16GB（缓存所有内部节点）</li></ul><p><strong>经验法则</strong>：计划数据库大小的10-20%作为RAM用于B树缓存。</p><h3 class="content-header" id="随时间推移的碎片化"><a href="#随时间推移的碎片化" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>随时间推移的碎片化</h3><p>经过多次插入和删除后，B树节点可能只有50-60%满。这会浪费空间并增加树的高度。</p><p><strong>解决方案：</strong> 定期VACUUM（PostgreSQL）或OPTIMIZE TABLE（MySQL）来重建B树。</p><h3 class="content-header" id="并发挑战"><a href="#并发挑战" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>并发挑战</h3><p>B树在分裂和合并期间需要锁定。在高并发工作负载中，锁争用可能成为写入的瓶颈。</p><h2 class="content-header" id="何时不用b树"><a href="#何时不用b树" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>何时不用B树</h2><p>B树非常适合基于磁盘的排序数据，但并非总是最优选择：</p><h3 class="content-header" id="写密集型工作负载"><a href="#写密集型工作负载" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>写密集型工作负载</h3><p>如果你每秒进行100,000次写入而读取很少，LSM树的表现优于B树。</p><p><strong>示例：</strong></p><ul><li>B树：MySQL、PostgreSQL、SQLite</li><li>LSM树：RocksDB、Cassandra、LevelDB</li></ul><h3 class="content-header" id="内存数据库"><a href="#内存数据库" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>内存数据库</h3><p>如果你的整个数据集适合RAM，B树会增加不必要的复杂性。哈希索引或跳表更简单、更快。</p><h3 class="content-header" id="分析型工作负载olap"><a href="#分析型工作负载olap" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>分析型工作负载（OLAP）</h3><p>对于扫描数百万行的大型分析查询，列式存储（如Parquet、ORC）优于B树。</p><h2 class="content-header" id="总结为什么b树胜出"><a href="#总结为什么b树胜出" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>总结：为什么B树胜出</h2><p>经过50多年的发展，B树仍然是主导的磁盘数据结构，因为它们：</p><ul><li><strong>最小化磁盘I/O</strong>：高扇出减少树高度</li><li><strong>自动平衡</strong>：分裂和合并保持所有叶子在同一深度</li><li><strong>支持范围查询</strong>：排序的键值和叶子级链接支持高效扫描</li><li><strong>适用于任何磁盘</strong>：对HDD（顺序I/O）和SSD（块级访问）都进行了优化</li></ul><p><strong>关键洞见</strong>：B树匹配磁盘存储的约束。由于最小的I/O单位是块，B树尽可能多地打包数据到每个块中。这个简单的想法——最大化扇出以最小化高度——使数据库变得快速。</p><h2 class="content-header" id="参考资料"><a href="#参考资料" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>参考资料</h2><p><strong>书籍推荐</strong>：</p><ul><li>《数据库系统内幕》Alex Petrov著（O&#x27;Reilly，2019）</li><li>《计算机程序设计艺术，第3卷：排序与查找（第2版）》Donald E. Knuth著</li></ul><p><strong>在线资源</strong>：</p><ul><li>MySQL官方文档：InnoDB B树索引</li><li>PostgreSQL官方文档：B树索引</li><li>SQLite文档：B树模块</li></ul><p>每当查询数据库并在毫秒内得到结果时，都要感谢B树。</p></div></div><div class="pb-6 pt-6 text-center text-gray-700 dark:text-gray-300" id="comment"></div><footer><div class="flex flex-col text-sm font-medium sm:flex-row sm:justify-between sm:text-base"><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" aria-label="Previous post: 为什么需要自己构建搜索引擎？" href="/blog/system/diy-search-engine">← <!-- -->为什么需要自己构建搜索引擎？</a></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" aria-label="Next post: 从文本到词元：分词管道的工作原理" href="/blog/ai/tokenization-pipeline">从文本到词元：分词管道的工作原理<!-- --> →</a></div></div></footer></div></div></article></section></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-3 flex space-x-4"><a class="text-sm !text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="mailto:mainjaylai@outlook.com"><span class="sr-only">mail</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-6 w-6"><path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"></path><path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"></path></svg></a><a class="text-sm !text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/mainjaylai"><span class="sr-only">github</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a><a class="text-sm !text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://gitlab.com/JayMain"><span class="sr-only">gitlab</span><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-6 w-6" width="200" height="200"><path d="M1022.08 579.712l-57.258667-176.426667-113.664-349.397333a19.413333 19.413333 0 0 0-36.992 0L700.501333 403.2H323.498667L209.877333 53.888C204.074667 35.84 178.56 35.84 172.8 53.76L59.136 403.157333 1.877333 579.712a39.424 39.424 0 0 0 14.122667 43.648L512 983.637333l496-360.234666a39.253333 39.253333 0 0 0 14.08-43.690667"></path></svg></a><a class="text-sm !text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://gitee.com/lmj2001"><span class="sr-only">gitee</span><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-6 w-6" width="200" height="200"><path d="M512 992C246.895625 992 32 777.104375 32 512S246.895625 32 512 32s480 214.895625 480 480-214.895625 480-480 480z m242.9521875-533.3278125h-272.56875a23.7121875 23.7121875 0 0 0-23.71125 23.7121875l-0.024375 59.255625c0 13.08 10.6078125 23.7121875 23.6878125 23.7121875h165.96c13.104375 0 23.7121875 10.6078125 23.7121875 23.6878125v11.855625a71.1121875 71.1121875 0 0 1-71.1121875 71.1121875h-225.215625a23.7121875 23.7121875 0 0 1-23.6878125-23.7121875V423.1278125a71.1121875 71.1121875 0 0 1 71.0878125-71.1121875h331.824375a23.7121875 23.7121875 0 0 0 23.6878125-23.71125l0.0721875-59.2565625a23.7121875 23.7121875 0 0 0-23.68875-23.7121875H423.08a177.76875 177.76875 0 0 0-177.76875 177.7921875V754.953125c0 13.1034375 10.60875 23.7121875 23.713125 23.7121875h349.63125a159.984375 159.984375 0 0 0 159.984375-159.984375V482.36a23.7121875 23.7121875 0 0 0-23.7121875-23.6878125z"></path></svg></a></div><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>MainJayLai</div><div> • </div><div>© 2025</div><div> • </div><a href="/">MainJayLai Blog</a></div></div></footer></div></section><script src="/_next/static/chunks/webpack-8506c16620cf39fb.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/media/36966cca54120369-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n2:HL[\"/_next/static/css/c890694439b2475b.css\",\"style\"]\n3:HL[\"/_next/static/css/1ea5cf861ee12a80.css\",\"style\"]\n4:HL[\"/_next/static/css/a9b9096fa657c0d0.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"5:I[5751,[],\"\"]\n8:I[9275,[],\"\"]\na:I[1343,[],\"\"]\nb:I[8700,[\"599\",\"static/chunks/ebde5ed1-51545511fe0d5050.js\",\"231\",\"static/chunks/231-34a6a67d2da26855.js\",\"827\",\"static/chunks/827-69594f61c16b8a9c.js\",\"850\",\"static/chunks/850-ecf153581cc02044.js\",\"185\",\"static/chunks/app/layout-54bebb918ae7f176.js\"],\"ThemeProviders\"]\nc:I[4080,[\"599\",\"static/chunks/ebde5ed1-51545511fe0d5050.js\",\"231\",\"static/chunks/231-34a6a67d2da26855.js\",\"827\",\"static/chunks/827-69594f61c16b8a9c.js\",\"850\",\"static/chunks/850-ecf153581cc02044.js\",\"185\",\"static/chunks/app/layout-54bebb918ae7f176.js\"],\"\"]\nd:I[9032,[\"599\",\"static/chunks/ebde5ed1-51545511fe0d5050.js\",\"231\",\"static/chunks/231-34a6a67d2da26855.js\",\"827\",\"static/chunks/827-69594f61c16b8a9c.js\",\"850\",\"static/chunks/850-ecf153581cc02044.js\",\"185\",\"static/chunks/app/layout-54bebb918ae7f176.js\"],\"KBarSearchProvider\"]\ne:I[231,[\"231\",\"static/chunks/231-34a6a67d2da26855.js\",\"827\",\"static/chunks/827-69594f61c16b8a9c.js\",\"797\",\"static/chunks/app/blog/%5B...slug%5D/page-bd056182432da53b.js\"],\"\"]\nf:I[8173,[\"231\",\"static/chunks/231-34a6a67d2da26855.js\",\"827\",\"static/chunks/827-69594f61c16b8a9c.js\",\"797\",\"static/chunks/app/blog/%5B...slug%5D/page-bd056182432da53b.js\"],\"Image\"]\n10:I[509,[\"599\",\"static/chunks/ebde5ed1-51545511fe0d5050.js\",\"231\",\"static/chunks/231-34a6a67d2da26855.js\",\"827\",\"static/chunks/827-69594f61c16b8a9c.js\",\"850\",\"static/chunks/850-ecf153581cc02044.js\",\"185\",\"static/chunks/app/layout-54bebb918ae7f176.js\"],\"KBarButton\"]\n11:I[1398,[\"599\",\"static/chunks/ebde5ed1-51545511fe0d5050.js\",\"231\",\"static/chunks/231-34a6a67d2da26855.js\",\"827\",\"static/chunks/827-69594f61c16b8a9c.js\",\"850\",\"static/chunks/850-ecf153581cc02044.js\",\"185\",\"static/chunks/app/layout-54bebb918ae7f176.js\"],\"default\"]\n12:I[7606,[\"599\",\"static/chunks/ebde5ed1-51545511fe0d5050.js\",\"231\",\"static/chunks/231-34a6a67d2da26855.js\",\"827\",\"static/chunks/827-69594f61c16b8a9c.js\",\"850\",\"static/chunks/850-ecf153581cc02044.js\",\"185\",\"static/chunks/app/layout-54bebb918ae7f176.js\"],\"default\"]\n13:I[7510,[\"599\",\"static/chunks/ebde5ed1-5"])</script><script>self.__next_f.push([1,"1545511fe0d5050.js\",\"231\",\"static/chunks/231-34a6a67d2da26855.js\",\"827\",\"static/chunks/827-69594f61c16b8a9c.js\",\"850\",\"static/chunks/850-ecf153581cc02044.js\",\"185\",\"static/chunks/app/layout-54bebb918ae7f176.js\"],\"default\"]\n14:I[8976,[\"599\",\"static/chunks/ebde5ed1-51545511fe0d5050.js\",\"231\",\"static/chunks/231-34a6a67d2da26855.js\",\"827\",\"static/chunks/827-69594f61c16b8a9c.js\",\"850\",\"static/chunks/850-ecf153581cc02044.js\",\"185\",\"static/chunks/app/layout-54bebb918ae7f176.js\"],\"default\"]\n16:I[6130,[],\"\"]\n9:[\"slug\",\"algorithm/B-Tree\",\"c\"]\n17:[]\n"])</script><script>self.__next_f.push([1,"0:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/c890694439b2475b.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/1ea5cf861ee12a80.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],[\"$\",\"$L5\",null,{\"buildId\":\"AO1lBacSEqBfLSl9iFzzQ\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/blog/algorithm/B-Tree\",\"initialTree\":[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"algorithm/B-Tree\",\"c\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":[\\\"algorithm\\\",\\\"B-Tree\\\"]}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"algorithm/B-Tree\",\"c\"],{\"children\":[\"__PAGE__\",{},[[\"$L6\",\"$L7\"],null],null]},[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\",\"$9\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/a9b9096fa657c0d0.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]]}],null]},[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}],null]},[[\"$\",\"html\",null,{\"lang\":\"en-us\",\"className\":\"__variable_dd5b2f scroll-smooth\",\"suppressHydrationWarning\":true,\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/png\",\"href\":\"https://mainjaylai.github.io/favicon.png\"}],[\"$\",\"link\",null,{\"rel\":\"manifest\",\"href\":\"/static/favicons/manifest.json\"}],[\"$\",\"meta\",null,{\"name\":\"msapplication-TileColor\",\"content\":\"#000000\"}],[\"$\",\"link\",null,{\"href\":\"https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@200..900\u0026display=swap\",\"rel\":\"stylesheet\"}],[\"$\",\"link\",null,{\"href\":\"https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe\u0026family=ZCOOL+QingKe+HuangYou\u0026family=ZCOOL+XiaoWei\u0026display=swap\",\"rel\":\"stylesheet\"}],[\"$\",\"script\",null,{\"src\":\"https://us.umami.is/script.js\",\"async\":true}],[\"$\",\"meta\",null,{\"name\":\"theme-color\",\"media\":\"(prefers-color-scheme: light)\",\"content\":\"#fff\"}],[\"$\",\"meta\",null,{\"name\":\"theme-color\",\"media\":\"(prefers-color-scheme: dark)\",\"content\":\"#000\"}],[\"$\",\"meta\",null,{\"name\":\"referrer\",\"content\":\"no-referrer\"}],[\"$\",\"script\",null,{\"src\":\"https://cdn.jsdelivr.net/gh/ashishagarwal2023/freegptjs@1.0.2/src/freegpt.min.js\"}],[\"$\",\"link\",null,{\"rel\":\"alternate\",\"type\":\"application/rss+xml\",\"href\":\"/feed.xml\"}]]}],[\"$\",\"body\",null,{\"className\":\"bg-white pl-[calc(100vw-100%)] text-black antialiased dark:bg-gray-950 dark:text-white\",\"suppressHydrationWarning\":true,\"children\":[\"$\",\"$Lb\",null,{\"children\":[[\"$undefined\",\"$undefined\",\"$undefined\",[\"$\",\"$Lc\",null,{\"async\":true,\"defer\":true,\"data-website-id\":\"bbe21cb3-3de3-4ba7-b6de-453053bc6ae8\",\"src\":\"https://us.umami.is/script.js\"}],\"$undefined\",\"$undefined\"],[\"$\",\"section\",null,{\"className\":\"mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex h-screen flex-col justify-between font-sans\",\"children\":[[\"$\",\"$Ld\",null,{\"kbarConfig\":{\"searchDocumentsPath\":\"/search.json\"},\"children\":[[\"$\",\"header\",null,{\"className\":\"flex items-center justify-between py-5\",\"children\":[[\"$\",\"div\",null,{\"children\":[\"$\",\"$Le\",null,{\"href\":\"/\",\"aria-label\":\"Blog\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between\",\"children\":[[\"$\",\"div\",null,{\"className\":\"mr-3\",\"children\":[\"$\",\"$Lf\",null,{\"src\":\"https://mainjaylai.github.io/favicon.png\",\"width\":44,\"height\":44,\"alt\":\"logo\"}]}],[\"$\",\"div\",null,{\"className\":\"hidden h-[44px] text-center text-3xl font-semibold leading-10 sm:block\",\"children\":\"Blog\"}]]}]}]}],[\"$\",\"div\",null,{\"className\":\"flex items-center space-x-4 leading-5 sm:space-x-6\",\"children\":[[[\"$\",\"$Le\",null,{\"href\":\"/blog\",\"className\":\"navbar-item hidden font-medium text-gray-900 dark:text-gray-100 sm:block\",\"children\":\"Blog\"}],[\"$\",\"$Le\",null,{\"href\":\"/tags\",\"className\":\"navbar-item hidden font-medium text-gray-900 dark:text-gray-100 sm:block\",\"children\":\"Tags\"}],[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://mainjaylai.github.io\",\"className\":\"navbar-item hidden font-medium text-gray-900 dark:text-gray-100 sm:block\",\"children\":\"About\"}]],[\"$\",\"$L10\",null,{\"aria-label\":\"Search\",\"children\":[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"fill\":\"none\",\"viewBox\":\"0 0 24 24\",\"strokeWidth\":1.5,\"stroke\":\"currentColor\",\"className\":\"h-6 w-6 text-gray-900 dark:text-gray-100\",\"children\":[\"$\",\"path\",null,{\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"d\":\"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z\"}]}]}],[\"$\",\"$L11\",null,{}],[\"$\",\"$L12\",null,{}],[\"$\",\"$L13\",null,{}],[\"$\",\"$L14\",null,{}]]}]]}],[\"$\",\"main\",null,{\"className\":\"mb-auto\",\"children\":[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[\"$\",\"div\",null,{\"className\":\"flex flex-col items-start justify-start md:mt-24 md:flex-row md:items-center md:justify-center md:space-x-6\",\"children\":[[\"$\",\"div\",null,{\"className\":\"space-x-2 pb-8 pt-6 md:space-y-5\",\"children\":[\"$\",\"h1\",null,{\"className\":\"text-6xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 md:border-r-2 md:px-6 md:text-8xl md:leading-14\",\"children\":\"404\"}]}],[\"$\",\"div\",null,{\"className\":\"max-w-md\",\"children\":[[\"$\",\"p\",null,{\"className\":\"mb-4 text-xl font-bold leading-normal md:text-2xl\",\"children\":\"Sorry we couldn't find this page.\"}],[\"$\",\"p\",null,{\"className\":\"mb-8\",\"children\":\"But dont worry, you can find plenty of other things on our homepage.\"}],[\"$\",\"$Le\",null,{\"href\":\"/\",\"className\":\"focus:shadow-outline-blue inline rounded-lg border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium leading-5 text-white shadow transition-colors duration-150 hover:bg-blue-700 focus:outline-none dark:hover:bg-blue-500\",\"children\":\"Back to homepage\"}]]}]]}],\"notFoundStyles\":[],\"styles\":null}]}]]}],[\"$\",\"footer\",null,{\"children\":[\"$\",\"div\",null,{\"className\":\"mt-16 flex flex-col items-center\",\"children\":[[\"$\",\"div\",null,{\"className\":\"mb-3 flex space-x-4\",\"children\":[[\"$\",\"a\",null,{\"className\":\"text-sm !text-gray-500 transition hover:text-gray-600\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"mailto:mainjaylai@outlook.com\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"mail\"}],[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 20 20\",\"className\":\"fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-6 w-6\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z\"}],[\"$\",\"path\",null,{\"d\":\"M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z\"}]]}]]}],[\"$\",\"a\",null,{\"className\":\"text-sm !text-gray-500 transition hover:text-gray-600\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/mainjaylai\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"github\"}],[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 24 24\",\"className\":\"fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-6 w-6\",\"children\":[\"$\",\"path\",null,{\"d\":\"M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12\"}]}]]}],[\"$\",\"a\",null,{\"className\":\"text-sm !text-gray-500 transition hover:text-gray-600\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://gitlab.com/JayMain\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"gitlab\"}],[\"$\",\"svg\",null,{\"viewBox\":\"0 0 1024 1024\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"className\":\"fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-6 w-6\",\"width\":\"200\",\"height\":\"200\",\"children\":[\"$\",\"path\",null,{\"d\":\"M1022.08 579.712l-57.258667-176.426667-113.664-349.397333a19.413333 19.413333 0 0 0-36.992 0L700.501333 403.2H323.498667L209.877333 53.888C204.074667 35.84 178.56 35.84 172.8 53.76L59.136 403.157333 1.877333 579.712a39.424 39.424 0 0 0 14.122667 43.648L512 983.637333l496-360.234666a39.253333 39.253333 0 0 0 14.08-43.690667\"}]}]]}],[\"$\",\"a\",null,{\"className\":\"text-sm !text-gray-500 transition hover:text-gray-600\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://gitee.com/lmj2001\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"gitee\"}],[\"$\",\"svg\",null,{\"viewBox\":\"0 0 1024 1024\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"className\":\"fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-6 w-6\",\"width\":\"200\",\"height\":\"200\",\"children\":[\"$\",\"path\",null,{\"d\":\"M512 992C246.895625 992 32 777.104375 32 512S246.895625 32 512 32s480 214.895625 480 480-214.895625 480-480 480z m242.9521875-533.3278125h-272.56875a23.7121875 23.7121875 0 0 0-23.71125 23.7121875l-0.024375 59.255625c0 13.08 10.6078125 23.7121875 23.6878125 23.7121875h165.96c13.104375 0 23.7121875 10.6078125 23.7121875 23.6878125v11.855625a71.1121875 71.1121875 0 0 1-71.1121875 71.1121875h-225.215625a23.7121875 23.7121875 0 0 1-23.6878125-23.7121875V423.1278125a71.1121875 71.1121875 0 0 1 71.0878125-71.1121875h331.824375a23.7121875 23.7121875 0 0 0 23.6878125-23.71125l0.0721875-59.2565625a23.7121875 23.7121875 0 0 0-23.68875-23.7121875H423.08a177.76875 177.76875 0 0 0-177.76875 177.7921875V754.953125c0 13.1034375 10.60875 23.7121875 23.713125 23.7121875h349.63125a159.984375 159.984375 0 0 0 159.984375-159.984375V482.36a23.7121875 23.7121875 0 0 0-23.7121875-23.6878125z\"}]}]]}]]}],[\"$\",\"div\",null,{\"className\":\"mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400\",\"children\":[[\"$\",\"div\",null,{\"children\":\"MainJayLai\"}],[\"$\",\"div\",null,{\"children\":\" • \"}],[\"$\",\"div\",null,{\"children\":\"© 2025\"}],[\"$\",\"div\",null,{\"children\":\" • \"}],[\"$\",\"$Le\",null,{\"href\":\"/\",\"children\":\"MainJayLai Blog\"}]]}]]}]}]]}]}]]}]}]]}],null],null],\"couldBeIntercepted\":false,\"initialHead\":[false,\"$L15\"],\"globalErrorComponent\":\"$16\",\"missingSlots\":\"$W17\"}]]\n"])</script><script>self.__next_f.push([1,"18:I[4347,[\"231\",\"static/chunks/231-34a6a67d2da26855.js\",\"827\",\"static/chunks/827-69594f61c16b8a9c.js\",\"797\",\"static/chunks/app/blog/%5B...slug%5D/page-bd056182432da53b.js\"],\"default\"]\n19:I[408,[\"231\",\"static/chunks/231-34a6a67d2da26855.js\",\"827\",\"static/chunks/827-69594f61c16b8a9c.js\",\"797\",\"static/chunks/app/blog/%5B...slug%5D/page-bd056182432da53b.js\"],\"default\"]\n1a:I[9629,[\"231\",\"static/chunks/231-34a6a67d2da26855.js\",\"827\",\"static/chunks/827-69594f61c16b8a9c.js\",\"797\",\"static/chunks/app/blog/%5B...slug%5D/page-bd056182432da53b.js\"],\"default\"]\n"])</script><script>self.__next_f.push([1,"7:[[\"$\",\"script\",null,{\"type\":\"application/ld+json\",\"dangerouslySetInnerHTML\":{\"__html\":\"{\\\"@context\\\":\\\"https://schema.org\\\",\\\"@type\\\":\\\"BlogPosting\\\",\\\"headline\\\":\\\"B树（B-Tree）详解 - 为什么每个数据库都在使用它\\\",\\\"datePublished\\\":\\\"2025-11-28T00:00:00.000Z\\\",\\\"dateModified\\\":\\\"2025-11-28T00:00:00.000Z\\\",\\\"description\\\":\\\"B树是一种自平衡树数据结构，专为磁盘存储优化。与二叉搜索树不同，B树的每个节点可以有成百上千个子节点，这大大减少了树的深度，使得在磁盘上的查找效率显著提高。本文深入解析B树的设计原理、实现细节，以及为什么50多年来它一直是数据库索引的首选数据结构。\\\",\\\"image\\\":\\\"/static/images/b-tree-structure.png\\\",\\\"url\\\":\\\"https://blog.mainjay.cloudns.ch/blog/algorithm/B-Tree\\\",\\\"author\\\":[{\\\"@type\\\":\\\"Person\\\",\\\"name\\\":\\\"mainJayLai\\\"}]}\"}}],[\"$\",\"section\",null,{\"className\":\"mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0\",\"children\":[[\"$\",\"$L18\",null,{}],[\"$\",\"article\",null,{\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"header\",null,{\"children\":[\"$\",\"div\",null,{\"className\":\"space-y-1 border-b border-gray-200 pb-10 text-center dark:border-gray-700\",\"children\":[[\"$\",\"div\",null,{\"className\":\"beautiful-chinese-title\",\"children\":[\"$\",\"h1\",null,{\"className\":\"text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14\",\"children\":\"B树（B-Tree）详解 - 为什么每个数据库都在使用它\"}]}],[\"$\",\"dl\",null,{\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"dt\",null,{\"className\":\"sr-only\",\"children\":\"Published on\"}],[\"$\",\"dd\",null,{\"className\":\"text-base font-medium leading-6 text-gray-500 dark:text-gray-400\",\"children\":[\"$\",\"time\",null,{\"dateTime\":\"2025-11-28T00:00:00.000Z\",\"children\":\"November 28, 2025\"}]}]]}]}]]}]}],[\"$\",\"div\",null,{\"className\":\"grid-rows-[auto_1fr] divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:divide-y-0\",\"children\":[[\"$\",\"div\",null,{\"className\":\"divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0\",\"children\":[\"$\",\"div\",null,{\"className\":\"beautiful-chinese-content prose max-w-none pb-8 pt-10 dark:prose-invert\",\"children\":[[\"$\",\"h2\",null,{\"className\":\"content-header\",\"id\":\"为什么需要b树\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#为什么需要b树\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"为什么需要B树？\"]}],[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"问题的起源\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#问题的起源\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"问题的起源\"]}],[\"$\",\"p\",null,{\"children\":\"storage/innobase/btr/btr0cur.cc\"}],[\"$\",\"blockquote\",null,{\"children\":[\"$\",\"p\",null,{\"children\":\"btr_page_split_and_insert() in btr_cur_pessimistic_insert() invokes...\"}]}],[\"$\",\"p\",null,{\"children\":\"悲观插入，这是当节点太满时的代码路径，当乐观插入失败时，当你必须分裂时。\"}],[\"$\",\"p\",null,{\"children\":[\"我跟着函数找到\",[\"$\",\"code\",null,{\"className\":\"custom-code\",\"children\":\"btr0btr.cc\"}],\"。数百行C代码、分裂条件、溢出保护、还有一个我没有的边界检查。\"]}],[\"$\",\"p\",null,{\"children\":\"我滚动查看我的Python代码：\"}],[\"$\",\"$L19\",null,{\"className\":\"language-python\",\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight language-python\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token builtin\",\"children\":\"len\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"node\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"keys\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e=\"}],\" self\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"order\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"  \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"# 没有-1\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    self\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"_split_child\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"parent\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" index\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}]]}]}],[\"$\",\"p\",null,{\"children\":\"书里已经警告过这一点。第263页：\\\"如果一个节点最多能容纳N个键值对，再插入一个就超过了它的最大容量N。\\\"\"}],[\"$\",\"p\",null,{\"children\":\"超过，不是等于，是超过！\"}],[\"$\",\"h2\",null,{\"className\":\"content-header\",\"id\":\"b树的设计思想\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#b树的设计思想\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"B树的设计思想\"]}],[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"核心思想\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#核心思想\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"核心思想\"]}],[\"$\",\"p\",null,{\"children\":[\"B树是一种自平衡树，专为磁盘访问优化。与二叉搜索树（每个节点只有2个子节点）不同，B树的每个节点有\",[\"$\",\"strong\",null,{\"children\":\"成百上千\"}],\"个子节点。\"]}],[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"关键思想\"}],\"：每个B树节点都装入一个磁盘块（4KB到16KB）。既然我们必须读取整个块，那就尽可能多地打包键值对。\"]}],[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"为什么这样设计是高效的\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#为什么这样设计是高效的\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"为什么这样设计是高效的？\"]}],[\"$\",\"ol\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"二进制特性\"}],\"：\"]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"任何正整数都可以表示为若干个2的幂的和\"}],[\"$\",\"li\",null,{\"children\":\"这种特性使得我们可以用O(log n)个节点表示任意区间\"}]]}]]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"区间管理\"}],\"：\"]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"每个节点管理的区间长度是2的幂\"}],[\"$\",\"li\",null,{\"children\":\"这种设计使得更新和查询操作都非常高效\"}]]}]]}]]}],[\"$\",\"h2\",null,{\"className\":\"content-header\",\"id\":\"二叉搜索树在磁盘上的问题\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#二叉搜索树在磁盘上的问题\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"二叉搜索树在磁盘上的问题\"]}],[\"$\",\"p\",null,{\"children\":\"让我们先从不适合的方法开始：二叉搜索树（BST）在磁盘上。\"}],[\"$\",\"p\",null,{\"children\":\"在内存中，二叉搜索树非常出色。每个节点存储一个键值，有两个子节点（左和右）。左子树中的键值较小，右子树中的键值较大。找到一个键值需要O(log₂ n)次比较。\"}],[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"alt\":\"二叉搜索树\",\"src\":\"https://substackcdn.com/image/fetch/$s_!kIqJ!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe9c04393-d2fb-47f0-93d7-d2724edbda56_705x502.png\"}]}],[\"$\",\"p\",null,{\"children\":[\"$\",\"em\",null,{\"children\":\"图1：有7个节点的二叉搜索树。查找键值11需要3次比较：15 → 7 → 11。\"}]}],[\"$\",\"p\",null,{\"children\":\"对于100万条记录，平衡的BST高度为log₂(1,000,000) ≈ 20。也就是说，找到任何记录需要20次比较。\"}],[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"在内存中，这很快。\"}],\" 每次比较是指针解引用（现代CPU上约0.0001毫秒）。总查找时间：0.002毫秒。\"]}],[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"在磁盘上，这是灾难性的。\"}],\" 原因如下：\"]}],[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"磁盘io很昂贵\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#磁盘io很昂贵\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"磁盘I/O很昂贵\"]}],[\"$\",\"p\",null,{\"children\":\"磁盘访问的最小单位是块（通常是4KB到16KB）。要从磁盘读取单个字节，你必须读取包含它的整个块。\"}],[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"磁盘访问时间：\"}]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"RAM访问：0.0001毫秒\"}],[\"$\",\"li\",null,{\"children\":\"SSD访问：0.1毫秒\"}],[\"$\",\"li\",null,{\"children\":\"HDD访问：10毫秒\"}],[\"$\",\"li\",null,{\"children\":\"磁盘比RAM慢100-100,000倍\"}]]}],[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"二叉树的灾难\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#二叉树的灾难\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"二叉树的灾难\"]}],[\"$\",\"p\",null,{\"children\":\"在磁盘上使用BST时，每个节点存储在单独的磁盘块中。从父节点遍历到子节点需要磁盘寻道。\"}],[\"$\",\"p\",null,{\"children\":\"对于100万条记录：\"}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"高度：20个节点\"}],[\"$\",\"li\",null,{\"children\":\"磁盘寻道：20次\"}],[\"$\",\"li\",null,{\"children\":[\"HDD上时间：20 × 10毫秒 = \",[\"$\",\"strong\",null,{\"children\":\"200毫秒\"}]]}],[\"$\",\"li\",null,{\"children\":[\"SSD上时间：20 × 0.1毫秒 = \",[\"$\",\"strong\",null,{\"children\":\"2毫秒\"}]]}]]}],[\"$\",\"p\",null,{\"children\":\"对于SSD来说还可以接受，但对HDD来说太糟糕了。随着树的增长，情况会变得更糟。\"}],[\"$\",\"p\",null,{\"children\":\"对于10亿条记录：\"}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"高度：30个节点\"}],[\"$\",\"li\",null,{\"children\":[\"HDD上时间：30 × 10毫秒 = \",[\"$\",\"strong\",null,{\"children\":\"300毫秒\"}]]}],[\"$\",\"li\",null,{\"children\":[\"SSD上时间：30 × 0.1毫秒 = \",[\"$\",\"strong\",null,{\"children\":\"3毫秒\"}]]}]]}],[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"根本问题：\"}],\" BST的扇出太低（每个节点只有2个子节点）。我们需要每个节点有更多的子节点来减少树的高度。\"]}],[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"为什么不直接平衡树\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#为什么不直接平衡树\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"为什么不直接平衡树？\"]}],[\"$\",\"p\",null,{\"children\":\"你可能会想：\\\"直接保持树的平衡！\\\" 红黑树和AVL树就是这样做的。\"}],[\"$\",\"p\",null,{\"children\":\"问题不只是树的高度——还有维护成本。平衡需要旋转节点和更新指针。在内存中，这很便宜（几次指针写入）。在磁盘上，这很昂贵：\"}],[\"$\",\"ol\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"从磁盘读取节点（4KB块）\"}],[\"$\",\"li\",null,{\"children\":\"在内存中修改节点\"}],[\"$\",\"li\",null,{\"children\":\"将修改后的节点写回磁盘（4KB块）\"}],[\"$\",\"li\",null,{\"children\":\"更新父指针（更多磁盘I/O）\"}]]}],[\"$\",\"p\",null,{\"children\":\"对于频繁插入和删除的树，不断的重新平衡会扼杀性能。我们需要一个：\"}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"具有高扇出（每个节点有多个子节点）→ 减少高度\"}],[\"$\",\"li\",null,{\"children\":\"需要很少的重新平衡 → 减少I/O开销\"}]]}],[\"$\",\"p\",null,{\"children\":\"的数据结构。\"}],[\"$\",\"p\",null,{\"children\":\"那个数据结构就是B树。\"}],[\"$\",\"h2\",null,{\"className\":\"content-header\",\"id\":\"什么是b树\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#什么是b树\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"什么是B树？\"]}],[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"b树结构\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#b树结构\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"B树结构\"]}],[\"$\",\"p\",null,{\"children\":[\"B树是自平衡树，为磁盘访问优化。与2个子节点的二叉树不同，B树节点有\",[\"$\",\"strong\",null,{\"children\":\"成百上千\"}],\"个子节点。\"]}],[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"关键思想：\"}],\" 每个B树节点装入一个磁盘块（4KB到16KB）。既然我们必须读取整个块，那就尽可能多地打包键值对。\"]}],[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"b树结构-1\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#b树结构-1\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"B树结构\"]}],[\"$\",\"p\",null,{\"children\":\"B树节点存储：\"}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"N个键值\"}],\"（排序的）\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"N + 1个指针\"}],\" 指向子节点\"]}]]}],[\"$\",\"p\",null,{\"children\":\"每个键值充当分隔符：child[i]中的键值 \u003c key[i] \u003c child[i+1]中的键值。\"}],[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"alt\":\"B树结构\",\"src\":\"https://substackcdn.com/image/fetch/$s_!txJ0!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2f0cbd7f-e98d-4fce-ae43-4945e46bf095_1582x502.png\"}]}],[\"$\",\"p\",null,{\"children\":[\"$\",\"em\",null,{\"children\":\"图2：扇出约100的B树。根节点有2个键和3个子节点。内部节点有4个键和5个子节点。叶子节点包含实际数据。\"}]}],[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"b树层次结构\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#b树层次结构\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"B树层次结构\"]}],[\"$\",\"p\",null,{\"children\":\"B树有三种类型的节点：\"}],[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"根节点：\"}],\" 树的顶部。总只有一个根。\"]}],[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"内部节点：\"}],\" 指导搜索的中间层。它们存储分隔键和指针，但不存储实际数据。\"]}],[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"叶子节点：\"}],\" 包含实际数据（键值对）的底层。所有叶子都在同一深度。\"]}],[\"$\",\"p\",null,{\"children\":[\"这是\",[\"$\",\"strong\",null,{\"children\":\"B+树\"}],\"（最常见的变种）。B+树只在叶子存储数据，而B树也可以在内部节点存储数据。每个主流数据库都使用B+树，但为了简单称之为\\\"B树\\\"。\"]}],[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"为什么高扇出很重要\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#为什么高扇出很重要\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"为什么高扇出很重要\"]}],[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"二叉树（扇出 = 2）：\"}]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"100万记录 → 高度 = 20\"}],[\"$\",\"li\",null,{\"children\":\"10亿记录 → 高度 = 30\"}]]}],[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"B树（扇出 = 100）：\"}]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"100万记录 → 高度 = 3（因为100³ = 1,000,000）\"}],[\"$\",\"li\",null,{\"children\":\"10亿记录 → 高度 = 5（因为100⁵ = 10,000,000,000）\"}]]}],[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"B树（扇出 = 1000）：\"}]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"100万记录 → 高度 = 2（因为1000² = 1,000,000）\"}],[\"$\",\"li\",null,{\"children\":\"10亿记录 → 高度 = 3（因为1000³ = 1,000,000,000）\"}]]}],[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"alt\":\"扇出对比\",\"src\":\"https://substackcdn.com/image/fetch/$s_!KWBT!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe4416acc-dcc2-4af7-80f6-a56aa8c8a9c6_1240x454.png\"}]}],[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"高扇出 = 更少的磁盘寻道 = 更快的查询。\"}]}],[\"$\",\"h2\",null,{\"className\":\"content-header\",\"id\":\"b树查找算法\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#b树查找算法\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"B树查找算法\"]}],[\"$\",\"p\",null,{\"children\":\"在B树中查找键值是从根到叶子的遍历，在每个节点进行二分查找。\"}],[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"算法：\"}]}],[\"$\",\"ol\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"从根节点开始\"}],[\"$\",\"li\",null,{\"children\":\"在当前节点内二分查找键值，找到分隔键值范围\"}],[\"$\",\"li\",null,{\"children\":\"跟随相应的子节点指针\"}],[\"$\",\"li\",null,{\"children\":\"重复直到到达叶子节点\"}],[\"$\",\"li\",null,{\"children\":\"在叶子中，要么找到键值，要么得出不存在的结论\"}]]}],[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"时间复杂度：\"}]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"树高度：O(log_fanout n)\"}],[\"$\",\"li\",null,{\"children\":\"每个节点二分查找：O(log₂ fanout)\"}],[\"$\",\"li\",null,{\"children\":\"总计：O(log n)\"}]]}],[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"示例：\"}],\" 在扇出100、100万记录的B树中查找键值72。\"]}],[\"$\",\"$L19\",null,{\"className\":\"language-js\",\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"步骤\",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],\"：读取根节点（\",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],\"次磁盘\",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"I\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"/\"}],[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"O\"}],\"）\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  键值：\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"50\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"100\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"150\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator spread\",\"children\":\"...\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"72\"}],\"在\",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"50\"}],\"和\",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"100\"}],\"之间\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  跟随子节点指针\",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"2\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"步骤\",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"2\"}],\"：读取内部节点（\",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],\"次磁盘\",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"I\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"/\"}],[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"O\"}],\"）\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  键值：\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"55\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"60\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"65\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"70\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"75\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"80\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator spread\",\"children\":\"...\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"72\"}],\"在\",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"70\"}],\"和\",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"75\"}],\"之间\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  跟随子节点指针\",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"5\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"步骤\",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"3\"}],\"：读取叶子节点（\",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],\"次磁盘\",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"I\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"/\"}],[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"O\"}],\"）\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  键值：\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"71\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"72\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"73\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"74\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  找到！返回键值\",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"72\"}],\"的值\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"总计：\",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"3\"}],\"次磁盘\",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"I\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"/\"}],[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"O\"}],\"操作 \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"HDD\"}],\"上\",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"30\"}],\"毫秒，\",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"SSD\"}],\"上\",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0.3\"}],\"毫秒\\n\"]}]]}]}],[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"python中的工作实现\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#python中的工作实现\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Python中的工作实现\"]}],[\"$\",\"p\",null,{\"children\":\"让我们用Python实现一个简化但功能完整的B树。\"}],[\"$\",\"$L19\",null,{\"className\":\"language-python\",\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight language-python\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"from\"}],\" typing \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"import\"}],\" List\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" Optional\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"from\"}],\" dataclasses \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"import\"}],\" dataclass\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" field\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation annotation decorator\",\"children\":\"@dataclass\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"class\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"BTreeNode\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"\\\"\\\"\\\"\\n\"}]]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"    B树节点，存储键值和子节点指针。\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"    属性:\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"        keys: 该节点中排序后的键值列表\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"        children: 子节点指针列表（长度 = len(keys) + 1）\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"        is_leaf: 是否为叶子节点（无子节点）\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"    不变量:\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"        - len(children) == len(keys) + 1（对于内部节点）\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"        - 所有键值都是排序的\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"        - children[i]中的键 \u003c keys[i] \u003c children[i+1]中的键\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"    \\\"\\\"\\\"\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    keys\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" List\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token builtin\",\"children\":\"int\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" field\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"default_factory\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token builtin\",\"children\":\"list\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    children\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" List\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"'BTreeNode'\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" field\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"default_factory\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token builtin\",\"children\":\"list\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    is_leaf\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token builtin\",\"children\":\"bool\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token boolean\",\"children\":\"True\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"def\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"__repr__\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"self\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string-interpolation\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"f\\\"BTreeNode(keys=\"}],[\"$\",\"span\",null,{\"className\":\"token interpolation\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"self\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"keys\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}]]}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\", is_leaf=\"}],[\"$\",\"span\",null,{\"className\":\"token interpolation\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"self\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"is_leaf\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}]]}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\")\\\"\"}]]}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"class\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"BTree\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"\\\"\\\"\\\"\\n\"}]]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"    B树实现，可配置阶数（最大子节点数）。\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"    属性:\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"        order: 每个节点的最大子节点数（扇出）\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"        root: 树的根节点\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"    属性:\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"        - 每个节点最多有 (order - 1) 个键\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"        - 每个非根节点至少有 (order // 2 - 1) 个键\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"        - 树高度是 O(log_order n)\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"    时间复杂度:\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"        - 查找: O(log n)\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"        - 插入: O(log n)\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"        - 删除: O(log n)\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"    空间复杂度: O(n)\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"    \\\"\\\"\\\"\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"def\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"__init__\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"self\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" order\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token builtin\",\"children\":\"int\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"100\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"\\\"\\\"\\\"\\n\"}]]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"        初始化B树。\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"        参数:\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"            order: 每个节点的最大子节点数（扇出）。\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"                   更高的阶数 = 更少的层数但更大的节点。\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"                   基于磁盘存储的典型值：100-1000。\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"        \\\"\\\"\\\"\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" order \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"3\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"raise\"}],\" ValueError\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"阶数必须至少为3\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        self\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"order \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" order\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        self\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"root \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" BTreeNode\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"def\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"search\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"self\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" key\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token builtin\",\"children\":\"int\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\" Optional\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token builtin\",\"children\":\"int\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"\\\"\\\"\\\"\\n\"}]]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"        在B树中搜索键值。\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"        参数:\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"            key: 要搜索的键值\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"        返回:\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"            如果找到返回键值，否则返回None\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"        时间复杂度: O(log n)，n为键的数量\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"        \\\"\\\"\\\"\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" self\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"_search_recursive\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"self\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"root\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" key\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"def\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"_search_recursive\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"self\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" node\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" BTreeNode\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" key\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token builtin\",\"children\":\"int\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\" Optional\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token builtin\",\"children\":\"int\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"\\\"\\\"\\\"\\n\"}]]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"        从节点开始递归搜索键值。\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"        使用节点内的二分查找找到正确的子节点。\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"        \\\"\\\"\\\"\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"# 节点内二分查找\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        i \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" self\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"_binary_search\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"node\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"keys\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" key\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"# 找到精确匹配\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" i \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token builtin\",\"children\":\"len\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"node\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"keys\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"and\"}],\" node\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"keys\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\"i\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"==\"}],\" key\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" key\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"# 到达叶子节点但未找到\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" node\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"is_leaf\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token boolean\",\"children\":\"None\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"# 递归到适当的子节点\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"# （实际实现中，这会是磁盘I/O）\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" self\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"_search_recursive\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"node\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"children\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\"i\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" key\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"def\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"_binary_search\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"self\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" keys\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" List\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token builtin\",\"children\":\"int\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" key\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token builtin\",\"children\":\"int\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token builtin\",\"children\":\"int\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"\\\"\\\"\\\"\\n\"}]]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"        二分查找键值的插入位置。\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"        返回:\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"            索引i，使得keys[i-1] \u003c key \u003c= keys[i]\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"        时间复杂度: O(log m)，m为节点中的键数量\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"        \\\"\\\"\\\"\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        left\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" right \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token builtin\",\"children\":\"len\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"keys\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"while\"}],\" left \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],\" right\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            mid \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"left \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" right\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"//\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"2\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" keys\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\"mid\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],\" key\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"                left \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" mid \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"else\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"                right \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" mid\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" left\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"def\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"insert\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"self\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" key\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token builtin\",\"children\":\"int\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"\\\"\\\"\\\"\\n\"}]]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"        向B树插入键值。\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"        参数:\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"            key: 要插入的键值\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"        时间复杂度: O(log n)\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"        算法:\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"            1. 找到合适的叶子节点\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"            2. 将键值插入叶子\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"            3. 如果叶子溢出（键值太多），分裂它\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"            4. 如果需要，将分裂向上传播\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"        \\\"\\\"\\\"\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        root \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" self\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"root\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"# 如果根节点满了，分裂它并创建新根\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token builtin\",\"children\":\"len\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"root\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"keys\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e=\"}],\" self\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"order \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            new_root \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" BTreeNode\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"is_leaf\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token boolean\",\"children\":\"False\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            new_root\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"children\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"append\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"self\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"root\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            self\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"_split_child\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"new_root\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            self\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"root \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" new_root\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        self\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"_insert_non_full\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"self\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"root\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" key\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"def\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"_insert_non_full\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"self\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" node\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" BTreeNode\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" key\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token builtin\",\"children\":\"int\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"\\\"\\\"\\\"\\n\"}]]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"        向未满的节点插入键值。\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"        递归地找到正确的叶子节点并插入。\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"        \\\"\\\"\\\"\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        i \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token builtin\",\"children\":\"len\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"node\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"keys\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" node\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"is_leaf\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"# 插入到排序位置\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            node\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"keys\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"append\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token boolean\",\"children\":\"None\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"  \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"# 腾出空间\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"while\"}],\" i \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"and\"}],\" key \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],\" node\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"keys\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\"i\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"                node\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"keys\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\"i \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" node\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"keys\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\"i\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"                i \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            node\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"keys\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\"i \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" key\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"else\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"# 找到要插入的子节点\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"while\"}],\" i \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"and\"}],\" key \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],\" node\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"keys\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\"i\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"                i \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            i \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"# 如果子节点满了，先分裂它\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token builtin\",\"children\":\"len\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"node\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"children\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\"i\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"keys\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e=\"}],\" self\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"order \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"                self\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"_split_child\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"node\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" i\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"                \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" key \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\" node\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"keys\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\"i\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"                    i \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            self\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"_insert_non_full\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"node\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"children\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\"i\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" key\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"def\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"_split_child\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"self\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" parent\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" BTreeNode\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" child_index\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token builtin\",\"children\":\"int\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"\\\"\\\"\\\"\\n\"}]]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"        分裂满的子节点为两个节点。\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"        参数:\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"            parent: 包含满子节点的父节点\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"            child_index: 满子节点在父节点children中的索引\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"        算法:\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"            1. 创建新的兄弟节点\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"            2. 将满子节点的一半键值移动到兄弟节点\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"            3. 将中间键值提升到父节点\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"            4. 更新父节点的子节点列表\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"        \\\"\\\"\\\"\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        full_child \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" parent\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"children\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\"child_index\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        new_sibling \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" BTreeNode\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"is_leaf\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\"full_child\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"is_leaf\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        mid \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"self\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"order \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"//\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"2\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"# 将一半键值移动到新兄弟节点\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        new_sibling\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"keys \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" full_child\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"keys\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\"mid \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        full_child\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"keys \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" full_child\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"keys\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"mid\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"# 如果不是叶子节点，移动一半子节点\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"not\"}],\" full_child\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"is_leaf\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            new_sibling\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"children \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" full_child\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"children\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\"mid \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            full_child\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"children \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" full_child\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"children\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"mid \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"# 将中间键值提升到父节点\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        promoted_key \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" full_child\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"keys\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\"mid\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        parent\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"keys\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"insert\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"child_index\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" promoted_key\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        parent\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"children\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"insert\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"child_index \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" new_sibling\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"def\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"print_tree\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"self\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" node\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" Optional\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\"BTreeNode\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token boolean\",\"children\":\"None\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" level\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token builtin\",\"children\":\"int\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"\\\"\\\"\\\"\\n\"}]]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"        打印树结构用于调试。\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token string triple-quoted-string\",\"children\":\"        \\\"\\\"\\\"\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" node \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"is\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token boolean\",\"children\":\"None\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            node \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" self\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"root\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"print\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"  \\\"\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\" level \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string-interpolation\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"f\\\"Level \"}],[\"$\",\"span\",null,{\"className\":\"token interpolation\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"level\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}]]}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\": \"}],[\"$\",\"span\",null,{\"className\":\"token interpolation\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"node\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"keys\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}]]}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"\"}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"not\"}],\" node\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"is_leaf\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"for\"}],\" child \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"in\"}],\" node\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"children\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"                self\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"print_tree\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"child\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" level \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"# 使用示例\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" __name__ \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"==\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"__main__\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"# 创建阶数为5的B树（每个节点最多4个键）\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    btree \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" BTree\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"order\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"5\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"# 插入键值\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    keys \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"10\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"20\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"5\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"6\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"12\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"30\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"7\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"17\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"3\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"16\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"21\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"24\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"25\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"26\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"27\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"print\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"插入键值:\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" keys\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"for\"}],\" key \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"in\"}],\" keys\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        btree\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"insert\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"key\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"print\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"\\\\nB树结构:\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    btree\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"print_tree\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"# 搜索键值\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"print\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"\\\\n搜索键值:\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"for\"}],\" search_key \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"in\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"6\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"16\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"21\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"100\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        result \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" btree\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"search\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"search_key\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" result\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"print\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string-interpolation\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"f\\\"  键 \"}],[\"$\",\"span\",null,{\"className\":\"token interpolation\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"search_key\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}]]}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\": 找到\\\"\"}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"else\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"print\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string-interpolation\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"f\\\"  键 \"}],[\"$\",\"span\",null,{\"className\":\"token interpolation\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"search_key\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}]]}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\": 未找到\\\"\"}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}]]}]}],[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"输出：\"}]}],[\"$\",\"$L19\",null,{\"className\":\"language-js\",\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token literal-property property\",\"children\":\"插入键值\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"10\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"20\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"5\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"6\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"12\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"30\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"7\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"17\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"3\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"16\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"21\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"24\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"25\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"26\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"27\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"B\"}],[\"$\",\"span\",null,{\"className\":\"token literal-property property\",\"children\":\"树结构\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Level\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"12\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"20\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"25\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Level\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"3\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"5\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"6\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"7\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"10\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Level\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"16\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"17\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Level\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"21\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"24\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Level\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"26\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"27\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"30\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token literal-property property\",\"children\":\"搜索键值\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  键 \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"6\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" 找到\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  键 \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"16\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" 找到\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  键 \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"21\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" 找到\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  键 \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"100\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" 未找到\\n\"]}]]}]}],[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"为什么这个实现有效：\"}]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"每个节点存储最多 \",[\"$\",\"code\",null,{\"className\":\"custom-code\",\"children\":\"order - 1\"}],\" 个键\"]}],[\"$\",\"li\",null,{\"children\":\"分裂操作维护B树的不变量\"}],[\"$\",\"li\",null,{\"children\":\"节点内二分查找减少比较\"}],[\"$\",\"li\",null,{\"children\":\"树高度保持对数\"}]]}],[\"$\",\"h2\",null,{\"className\":\"content-header\",\"id\":\"b树节点分裂\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#b树节点分裂\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"B树节点分裂\"]}],[\"$\",\"p\",null,{\"children\":\"当你向满的叶子节点插入键值时，节点必须分裂。\"}],[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"分裂算法：\"}]}],[\"$\",\"ol\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"找到满节点的中点\"}],[\"$\",\"li\",null,{\"children\":\"创建新的兄弟节点\"}],[\"$\",\"li\",null,{\"children\":\"将一半键值移动到新节点\"}],[\"$\",\"li\",null,{\"children\":\"将中间键值提升到父节点\"}],[\"$\",\"li\",null,{\"children\":\"如果父节点满了，递归地分裂它\"}]]}],[\"$\",\"p\",null,{\"children\":\"当分裂传播到根节点时：\"}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"根节点分裂为两个节点\"}],[\"$\",\"li\",null,{\"children\":\"创建新根节点，包含一个键值（从旧根提升的）\"}],[\"$\",\"li\",null,{\"children\":\"树高增加1\"}]]}],[\"$\",\"p\",null,{\"children\":[\"这是B树高度增加的唯一方式。\",[\"$\",\"strong\",null,{\"children\":\"B树从叶子向上生长，而不是从根向下生长。\"}]]}],[\"$\",\"h2\",null,{\"className\":\"content-header\",\"id\":\"b树的性能特征\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#b树的性能特征\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"B树的性能特征\"]}],[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"查找复杂度\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#查找复杂度\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"查找复杂度\"]}],[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"时间复杂度\"}],\"：O(log n)\"]}],[\"$\",\"p\",null,{\"children\":\"对于n个键值、扇出f的树：\"}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"树高度：log_f(n)\"}],[\"$\",\"li\",null,{\"children\":\"每个节点二分查找：log₂(f)\"}],[\"$\",\"li\",null,{\"children\":\"总比较次数：log_f(n) × log₂(f) = O(log n)\"}]]}],[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"磁盘I/O\"}],\"：log_f(n) 次磁盘读取（每层一次）\"]}],[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"插入复杂度\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#插入复杂度\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"插入复杂度\"]}],[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"时间复杂度\"}],\"：O(log n)\"]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"查找插入位置：O(log n)\"}],[\"$\",\"li\",null,{\"children\":\"插入到叶子：O(f) 移动键值\"}],[\"$\",\"li\",null,{\"children\":\"必要时分裂：O(f) 移动键值\"}],[\"$\",\"li\",null,{\"children\":\"分裂向上传播：最坏情况O(log n) 层\"}]]}],[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"磁盘I/O\"}],\"：O(log n) 次磁盘读取 + O(log n) 次磁盘写入\"]}],[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"删除复杂度\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#删除复杂度\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"删除复杂度\"]}],[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"时间复杂度\"}],\"：O(log n)\"]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"查找键值：O(log n)\"}],[\"$\",\"li\",null,{\"children\":\"从叶子删除：O(f) 移动键值\"}],[\"$\",\"li\",null,{\"children\":\"必要时合并：O(f) 移动键值\"}],[\"$\",\"li\",null,{\"children\":\"合并向上传播：最坏情况O(log n) 层\"}]]}],[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"磁盘I/O\"}],\"：O(log n) 次磁盘读取 + O(log n) 次磁盘写入\"]}],[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"空间复杂度\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#空间复杂度\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"空间复杂度\"]}],[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"空间\"}],\"：O(n)\"]}],[\"$\",\"p\",null,{\"children\":\"每个键值存储一次。内部节点增加开销（指针和分隔键），但这通常是数据大小的10-20%。\"}],[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"占用率\"}],\"：节点通常是50-90%满。更高的扇出提高空间效率，因为指针开销成比例地变小。\"]}],[\"$\",\"h2\",null,{\"className\":\"content-header\",\"id\":\"真实世界的b树应用\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#真实世界的b树应用\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"真实世界的B树应用\"]}],[\"$\",\"p\",null,{\"children\":\"每个主要数据库都使用B树（或B+树）作为索引。\"}],[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"mysql-innodb\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#mysql-innodb\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"MySQL InnoDB\"]}],[\"$\",\"p\",null,{\"children\":\"InnoDB使用B+树作为：\"}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"主键索引\"}],\"（聚簇索引）：叶子节点存储实际行数据\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"二级索引\"}],\"：叶子节点存储指向主键的指针\"]}]]}],[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"InnoDB B树配置\"}],\"：\"]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"页大小：16KB（默认）\"}],[\"$\",\"li\",null,{\"children\":\"扇出：约100-200，取决于键值大小\"}],[\"$\",\"li\",null,{\"children\":\"100万行数据的树高：3-4层\"}]]}],[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"示例：\"}]}],[\"$\",\"$L19\",null,{\"className\":\"language-sql\",\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight language-sql\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"-- 创建带主键的表\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"CREATE\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"TABLE\"}],\" users \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    id \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"INT\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"PRIMARY\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"KEY\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    name \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"VARCHAR\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"100\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    email \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"VARCHAR\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"100\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"ENGINE\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"InnoDB\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"-- 主键自动创建聚簇B+树索引\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"-- 叶子节点包含实际行数据\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"-- 树结构：id=1与name和email一起存储在叶子中\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"-- 在email上创建二级索引\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"CREATE\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"INDEX\"}],\" idx_email \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"ON\"}],\" users\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"email\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"-- 二级索引是单独的B+树\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"-- 叶子节点包含email → id映射\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"-- 要获取完整行：在idx_email中查找email → 获取id → 查找主键中的id\"}],\"\\n\"]}]]}]}],[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"postgresql\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#postgresql\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"PostgreSQL\"]}],[\"$\",\"p\",null,{\"children\":\"PostgreSQL默认使用B树作为索引类型。\"}],[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"PostgreSQL B树配置\"}],\"：\"]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"页大小：8KB（默认）\"}],[\"$\",\"li\",null,{\"children\":\"扇出：约50-100，取决于键值大小\"}],[\"$\",\"li\",null,{\"children\":\"支持多种索引类型，但B树是默认\"}]]}],[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"其他数据库系统\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#其他数据库系统\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"其他数据库系统\"]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"SQLite\"}],\"：使用B树存储表和索引\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"MongoDB WiredTiger\"}],\"：使用B树作为索引\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Oracle\"}],\"、\",[\"$\",\"strong\",null,{\"children\":\"SQL Server\"}],\"：都使用B树的变体\"]}]]}],[\"$\",\"h2\",null,{\"className\":\"content-header\",\"id\":\"权衡和限制\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#权衡和限制\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"权衡和限制\"]}],[\"$\",\"p\",null,{\"children\":\"B树并不完美。以下是它们遇到的困难：\"}],[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"写放大\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#写放大\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"写放大\"]}],[\"$\",\"p\",null,{\"children\":\"每次插入都可能触发一直传播到根的分裂。最坏情况下：\"}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"插入1个键 → 分裂叶子 → 分裂父节点 → 分裂祖父节点 → 分裂根节点\"}],[\"$\",\"li\",null,{\"children\":\"1个逻辑写入变成4+个物理写入\"}]]}],[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"示例：\"}],\" 插入100万个键值，频繁分裂：\"]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"逻辑写入：100万\"}],[\"$\",\"li\",null,{\"children\":\"物理写入（带分裂）：200-300万\"}],[\"$\",\"li\",null,{\"children\":\"写放大：2-3倍\"}]]}],[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"替代方案：\"}],\" LSM树（Log-Structured Merge Trees），被RocksDB、Cassandra使用。\"]}],[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"非顺序键值上的范围查询\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#非顺序键值上的范围查询\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"非顺序键值上的范围查询\"]}],[\"$\",\"p\",null,{\"children\":\"B树为索引键值上的范围查询进行了优化，但在多列范围查询方面有困难。\"}],[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"示例：\"}]}],[\"$\",\"$L19\",null,{\"className\":\"language-sql\",\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight language-sql\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"-- 快速：索引列上的范围查询\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"SELECT\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"FROM\"}],\" orders \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"WHERE\"}],\" order_date \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"BETWEEN\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"'2024-01-01'\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"AND\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"'2024-12-31'\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"-- B树顺序遍历叶子节点（叶子节点是链接的）\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"-- 慢：非索引列上的范围查询\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"SELECT\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"FROM\"}],\" orders \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"WHERE\"}],\" total_amount \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"BETWEEN\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"100\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"AND\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"200\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"-- 必须扫描整个表（total_amount上没有索引）\"}],\"\\n\"]}]]}]}],[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"缓存的内存开销\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#缓存的内存开销\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"缓存的内存开销\"]}],[\"$\",\"p\",null,{\"children\":\"为了避免磁盘I/O，数据库在内存中缓存频繁访问的B树节点。对于大型数据库：\"}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"10亿条记录\"}],[\"$\",\"li\",null,{\"children\":\"树高：4层\"}],[\"$\",\"li\",null,{\"children\":\"内部节点：约100万个\"}],[\"$\",\"li\",null,{\"children\":\"缓存大小：约16GB（缓存所有内部节点）\"}]]}],[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"经验法则\"}],\"：计划数据库大小的10-20%作为RAM用于B树缓存。\"]}],[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"随时间推移的碎片化\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#随时间推移的碎片化\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"随时间推移的碎片化\"]}],[\"$\",\"p\",null,{\"children\":\"经过多次插入和删除后，B树节点可能只有50-60%满。这会浪费空间并增加树的高度。\"}],[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"解决方案：\"}],\" 定期VACUUM（PostgreSQL）或OPTIMIZE TABLE（MySQL）来重建B树。\"]}],[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"并发挑战\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#并发挑战\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"并发挑战\"]}],[\"$\",\"p\",null,{\"children\":\"B树在分裂和合并期间需要锁定。在高并发工作负载中，锁争用可能成为写入的瓶颈。\"}],[\"$\",\"h2\",null,{\"className\":\"content-header\",\"id\":\"何时不用b树\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#何时不用b树\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"何时不用B树\"]}],[\"$\",\"p\",null,{\"children\":\"B树非常适合基于磁盘的排序数据，但并非总是最优选择：\"}],[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"写密集型工作负载\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#写密集型工作负载\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"写密集型工作负载\"]}],[\"$\",\"p\",null,{\"children\":\"如果你每秒进行100,000次写入而读取很少，LSM树的表现优于B树。\"}],[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"示例：\"}]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"B树：MySQL、PostgreSQL、SQLite\"}],[\"$\",\"li\",null,{\"children\":\"LSM树：RocksDB、Cassandra、LevelDB\"}]]}],[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"内存数据库\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#内存数据库\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"内存数据库\"]}],[\"$\",\"p\",null,{\"children\":\"如果你的整个数据集适合RAM，B树会增加不必要的复杂性。哈希索引或跳表更简单、更快。\"}],[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"分析型工作负载olap\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#分析型工作负载olap\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"分析型工作负载（OLAP）\"]}],[\"$\",\"p\",null,{\"children\":\"对于扫描数百万行的大型分析查询，列式存储（如Parquet、ORC）优于B树。\"}],[\"$\",\"h2\",null,{\"className\":\"content-header\",\"id\":\"总结为什么b树胜出\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#总结为什么b树胜出\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"总结：为什么B树胜出\"]}],[\"$\",\"p\",null,{\"children\":\"经过50多年的发展，B树仍然是主导的磁盘数据结构，因为它们：\"}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"最小化磁盘I/O\"}],\"：高扇出减少树高度\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"自动平衡\"}],\"：分裂和合并保持所有叶子在同一深度\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"支持范围查询\"}],\"：排序的键值和叶子级链接支持高效扫描\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"适用于任何磁盘\"}],\"：对HDD（顺序I/O）和SSD（块级访问）都进行了优化\"]}]]}],[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"关键洞见\"}],\"：B树匹配磁盘存储的约束。由于最小的I/O单位是块，B树尽可能多地打包数据到每个块中。这个简单的想法——最大化扇出以最小化高度——使数据库变得快速。\"]}],[\"$\",\"h2\",null,{\"className\":\"content-header\",\"id\":\"参考资料\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#参考资料\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"参考资料\"]}],[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"书籍推荐\"}],\"：\"]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"《数据库系统内幕》Alex Petrov著（O'Reilly，2019）\"}],[\"$\",\"li\",null,{\"children\":\"《计算机程序设计艺术，第3卷：排序与查找（第2版）》Donald E. Knuth著\"}]]}],[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"在线资源\"}],\"：\"]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"MySQL官方文档：InnoDB B树索引\"}],[\"$\",\"li\",null,{\"children\":\"PostgreSQL官方文档：B树索引\"}],[\"$\",\"li\",null,{\"children\":\"SQLite文档：B树模块\"}]]}],[\"$\",\"p\",null,{\"children\":\"每当查询数据库并在毫秒内得到结果时，都要感谢B树。\"}]]}]}],[\"$\",\"div\",null,{\"className\":\"pb-6 pt-6 text-center text-gray-700 dark:text-gray-300\",\"id\":\"comment\",\"children\":[\"$\",\"$L1a\",null,{\"slug\":\"algorithm/B-Tree\"}]}],[\"$\",\"footer\",null,{\"children\":[\"$\",\"div\",null,{\"className\":\"flex flex-col text-sm font-medium sm:flex-row sm:justify-between sm:text-base\",\"children\":[[\"$\",\"div\",null,{\"className\":\"pt-4 xl:pt-8\",\"children\":[\"$\",\"$Le\",null,{\"href\":\"/blog/system/diy-search-engine\",\"className\":\"text-primary-500 hover:text-primary-600 dark:hover:text-primary-400\",\"aria-label\":\"Previous post: 为什么需要自己构建搜索引擎？\",\"children\":[\"← \",\"为什么需要自己构建搜索引擎？\"]}]}],[\"$\",\"div\",null,{\"className\":\"pt-4 xl:pt-8\",\"children\":[\"$\",\"$Le\",null,{\"href\":\"/blog/ai/tokenization-pipeline\",\"className\":\"text-primary-500 hover:text-primary-600 dark:hover:text-primary-400\",\"aria-label\":\"Next post: 从文本到词元：分词管道的工作原理\",\"children\":[\"从文本到词元：分词管道的工作原理\",\" →\"]}]}]]}]}]]}]]}]}]]}]]\n"])</script><script>self.__next_f.push([1,"15:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"B树（B-Tree）详解 - 为什么每个数据库都在使用它\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"B树是一种自平衡树数据结构，专为磁盘存储优化。与二叉搜索树不同，B树的每个节点可以有成百上千个子节点，这大大减少了树的深度，使得在磁盘上的查找效率显著提高。本文深入解析B树的设计原理、实现细节，以及为什么50多年来它一直是数据库索引的首选数据结构。\"}],[\"$\",\"meta\",\"4\",{\"name\":\"robots\",\"content\":\"index, follow\"}],[\"$\",\"meta\",\"5\",{\"name\":\"googlebot\",\"content\":\"index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1\"}],[\"$\",\"link\",\"6\",{\"rel\":\"canonical\",\"href\":\"https://blog.mainjay.cloudns.ch/blog/algorithm/B-Tree\"}],[\"$\",\"link\",\"7\",{\"rel\":\"alternate\",\"type\":\"application/rss+xml\",\"href\":\"https://blog.mainjay.cloudns.ch/feed.xml\"}],[\"$\",\"meta\",\"8\",{\"property\":\"og:title\",\"content\":\"B树（B-Tree）详解 - 为什么每个数据库都在使用它\"}],[\"$\",\"meta\",\"9\",{\"property\":\"og:description\",\"content\":\"B树是一种自平衡树数据结构，专为磁盘存储优化。与二叉搜索树不同，B树的每个节点可以有成百上千个子节点，这大大减少了树的深度，使得在磁盘上的查找效率显著提高。本文深入解析B树的设计原理、实现细节，以及为什么50多年来它一直是数据库索引的首选数据结构。\"}],[\"$\",\"meta\",\"10\",{\"property\":\"og:url\",\"content\":\"https://blog.mainjay.cloudns.ch/blog/algorithm/B-Tree\"}],[\"$\",\"meta\",\"11\",{\"property\":\"og:site_name\",\"content\":\"MainJayLai Blog\"}],[\"$\",\"meta\",\"12\",{\"property\":\"og:locale\",\"content\":\"en_US\"}],[\"$\",\"meta\",\"13\",{\"property\":\"og:image\",\"content\":\"https://blog.mainjay.cloudns.ch/static/images/b-tree-structure.png\"}],[\"$\",\"meta\",\"14\",{\"property\":\"og:type\",\"content\":\"article\"}],[\"$\",\"meta\",\"15\",{\"property\":\"article:published_time\",\"content\":\"2025-11-28T00:00:00.000Z\"}],[\"$\",\"meta\",\"16\",{\"property\":\"article:modified_time\",\"content\":\"2025-11-28T00:00:00.000Z\"}],[\"$\",\"meta\",\"17\",{\"property\":\"article:author\",\"content\":\"mainJayLai\"}],[\"$\",\"meta\",\"18\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"19\",{\"name\":\"twitter:title\",\"content\":\"B树（B-Tree）详解 - 为什么每个数据库都在使用它\"}],[\"$\",\"meta\",\"20\",{\"name\":\"twitter:description\",\"content\":\"B树是一种自平衡树数据结构，专为磁盘存储优化。与二叉搜索树不同，B树的每个节点可以有成百上千个子节点，这大大减少了树的深度，使得在磁盘上的查找效率显著提高。本文深入解析B树的设计原理、实现细节，以及为什么50多年来它一直是数据库索引的首选数据结构。\"}],[\"$\",\"meta\",\"21\",{\"name\":\"twitter:image\",\"content\":\"https://blog.mainjay.cloudns.ch/static/images/b-tree-structure.png\"}],[\"$\",\"meta\",\"22\",{\"name\":\"next-size-adjust\"}]]\n"])</script><script>self.__next_f.push([1,"6:null\n"])</script></body></html>